<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Avançado de Checklist de Manutenção</title>
    <script>(function(){try{var s=localStorage.getItem('theme');var p=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;var d=s?s==='dark':p;if(d){document.documentElement.classList.add('dark');}}catch(e){}})();</script>
    
    <!-- CDN do Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Outras dependências -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/index.min.js"></script>
    <script>
        // Configuração do Tailwind (Play CDN)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4B46C7',
                        'primary-light': '#8B8DF0',
                        success: '#10B981',
                        warning: '#F59E0B', 
                        danger: '#EF4444',
                        info: '#3B82F6'
                    },
                    backdropBlur: {
                        'xs': '2px'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Animações avançadas */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        .slide-in { animation: slideInLeft 0.4s ease-out; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        .bounce-in { animation: bounceIn 0.6s ease-out; }
        .float { animation: float 3s ease-in-out infinite; }
        .glow { animation: glow 2s ease-in-out infinite alternate; }
        .pulse-glow { animation: pulseGlow 1.5s ease-in-out infinite; }
        .scale-in { animation: scaleIn 0.3s ease-out; }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes slideInLeft { 
            from { opacity: 0; transform: translateX(-30px); } 
            to { opacity: 1; transform: translateX(0); } 
        }
        @keyframes slideInRight { 
            from { opacity: 0; transform: translateX(30px); } 
            to { opacity: 1; transform: translateX(0); } 
        }
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(30px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes bounceIn { 
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        @keyframes float { 
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        @keyframes glow {
            from { box-shadow: 0 0 5px #5D5CDE, 0 0 10px #5D5CDE, 0 0 15px #5D5CDE; }
            to { box-shadow: 0 0 10px #5D5CDE, 0 0 20px #5D5CDE, 0 0 30px #5D5CDE; }
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 4px 15px rgba(93, 92, 222, 0.3); }
            50% { box-shadow: 0 8px 25px rgba(93, 92, 222, 0.6); }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes progress {
            from { width: 0%; }
            to { width: var(--progress-width); }
        }
        
        /* Glass Morphism Effect */
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-morphism {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Gradient Backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-primary {
            background: linear-gradient(135deg, #5D5CDE 0%, #8B8DF0 100%);
        }
        .gradient-success {
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
        }
        .gradient-warning {
            background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
        }
        .gradient-danger {
            background: linear-gradient(135deg, #EF4444 0%, #F87171 100%);
        }
        
        /* Progress Bar */
        .progress-bar {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Notifications */
        .notification-slide {
            animation: slideInFromTop 0.4s ease-out;
        }
        @keyframes slideInFromTop {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        .dark .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4B5563 50%, #374151 75%);
            background-size: 200% 100%;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
        }
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .tooltip:hover::after {
            opacity: 1;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #c1c1c1, #a8a8a8);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #a8a8a8, #959595);
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #6B7280, #9CA3AF);
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #9CA3AF, #D1D5DB);
        }
        
        /* Card Hover Effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .dark .card-hover:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
        
        /* Interactive Elements */
        .interactive-scale {
            transition: transform 0.2s ease-in-out;
        }
        .interactive-scale:hover {
            transform: scale(1.02);
        }
        .interactive-scale:active {
            transform: scale(0.98);
        }
        
        /* Status Indicators */
        .status-dot {
            position: relative;
        }
        .status-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        .status-dot.success::before {
            background-color: #10B981;
        }
        .status-dot.warning::before {
            background-color: #F59E0B;
        }
        .status-dot.danger::before {
            background-color: #EF4444;
        }
        
        /* Data visualization */
        .chart-container {
            position: relative;
            height: min(400px, 50vh);
            min-height: 240px;
            width: 100%;
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                font-size: 12px;
            }
        }
        
        /* Novos estilos para melhorias */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-container {
            max-width: 400px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .equipment-image {
            width: 100%;
            height: auto;
            max-height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .qr-code {
            width: clamp(80px, 25vw, 120px);
            height: clamp(80px, 25vw, 120px);
            margin: 0 auto;
            display: block;
        }
        
        .inspection-details-modal {
            width: 90vw;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="glass-morphism p-8 rounded-xl shadow-lg max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-primary rounded-lg flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Sistema de Checklist</h2>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Faça login para acessar o sistema</p>
            </div>
            
            <form id="loginForm" data-mode="login">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                    <input type="email" id="loginEmail" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Senha</label>
                    <input type="password" id="loginPassword" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <button id="loginSubmit" type="submit" class="w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors duration-200 font-medium interactive-scale">
                    Entrar
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    Não tem uma conta? 
                    <button onclick="toggleAuthMode()" class="text-primary hover:text-primary-dark font-medium">Cadastre-se</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="glass-morphism p-6 rounded-lg shadow-lg">
            <div class="flex items-center space-x-3">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <span class="text-gray-900 dark:text-white">Carregando...</span>
            </div>
        </div>
    </div>

    <!-- Main App (inicialmente oculto) -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="glass-morphism backdrop-blur-xs shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center glow">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h1 class="text-xl font-semibold text-gray-900 dark:text-white">Sistema de Checklist</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-500 dark:text-gray-400" id="currentDateTime"></div>
                        <button onclick="toggleTheme()" class="p-2 rounded-md glass-morphism backdrop-blur-xs interactive-scale tooltip" data-tooltip="Alternar tema">
                            <svg class="w-5 h-5 text-gray-700 dark:text-gray-300 inline dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-6.364l-1.414 1.414M7.05 16.95l-1.414 1.414m12.728 0l-1.414-1.414M7.05 7.05L5.636 5.636M12 8a4 4 0 100 8 4 4 0 000-8z"/>
                            </svg>
                            <svg class="w-5 h-5 text-gray-300 dark:text-gray-100 hidden dark:inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 118.646 3.646a7 7 0 1011.708 11.708z"/>
                            </svg>
                        </button>
                        <button onclick="openSettings()" class="p-2 rounded-md glass-morphism backdrop-blur-xs interactive-scale tooltip" data-tooltip="Configurações">
                            <svg class="w-5 h-5 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-1.14 1.952-1.14 2.252 0a1.724 1.724 0 002.573 1.066c.986-.57 2.23.37 1.995 1.454a1.724 1.724 0 001.051 1.93c1.07.39 1.07 1.92 0 2.31a1.724 1.724 0 00-1.051 1.93c.235 1.083-.999 2.024-1.995 1.454a1.724 1.724 0 00-2.573 1.066c-.3 1.14-1.952 1.14-2.252 0a1.724 1.724 0 00-2.573-1.066c-.996.57-2.23-.37-1.995-1.454a1.724 1.724 0 00-1.051-1.93c-1.07-.39-1.07-1.92 0-2.31.63-.23 1.06-.77 1.051-1.93-.235-1.083.999-2.024 1.995-1.454.87.503 1.973.07 2.573-1.066z"/>
                            </svg>
                        </button>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-700 dark:text-gray-300" id="userEmail"></span>
                            <button onclick="logout()" class="text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                                Sair
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="glass-morphism backdrop-blur-xs border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center">
                    <div class="flex space-x-8">
                        <button onclick="showSection('dashboard')" class="nav-btn active border-b-2 border-primary text-primary px-1 py-4 text-sm font-medium">
                            Dashboard
                        </button>
                        <button onclick="showSection('nova-inspecao')" class="nav-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 px-1 py-4 text-sm font-medium">
                            Nova Inspeção
                        </button>
                        <button onclick="showSection('historico')" class="nav-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 px-1 py-4 text-sm font-medium">
                            Histórico
                        </button>
                        <button onclick="showSection('analytics')" class="nav-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 px-1 py-4 text-sm font-medium">
                            Analytics
                        </button>
                        <button onclick="showSection('relatorios')" class="nav-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 px-1 py-4 text-sm font-medium">
                            Relatórios
                        </button>
                        <button onclick="showSection('equipamentos')" class="nav-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 px-1 py-4 text-sm font-medium">
                            Equipamentos
                        </button>
                    </div>
                    
                    <!-- Search and Quick Actions -->
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="text" id="globalSearch" placeholder="Buscar inspeções..." class="w-full sm:w-64 px-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <svg class="absolute right-3 top-2.5 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                        <button onclick="showNotificationCenter()" class="relative p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">3</span>
                        </button>
                        <button onclick="exportData()" class="tooltip px-3 py-2 text-sm bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors duration-200 interactive-scale" data-tooltip="Exportar dados">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Notification Center -->
        <div id="notificationCenter" class="hidden fixed top-16 right-4 z-50 w-full max-w-sm glass-morphism shadow-2xl rounded-xl border border-gray-200 dark:border-gray-700 max-h-96 overflow-hidden">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Notificações</h3>
                <div class="flex items-center gap-3">
                    <button onclick="markAllNotificationsRead()" class="text-sm text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">Marcar como lidas</button>
                    <button onclick="clearAllNotifications()" class="text-sm text-primary hover:text-primary-dark">Limpar todas</button>
                </div>
            </div>
            <div id="notificationList" class="max-h-80 overflow-y-auto custom-scrollbar p-2">
                <!-- Notifications will be populated here -->
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="glass-morphism p-6 rounded-xl shadow-2xl w-full max-w-sm mx-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Configurações</h3>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tema</label>
                <select id="themeModeSelect" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="system">Sistema</option>
                    <option value="light">Claro</option>
                    <option value="dark">Escuro</option>
                </select>
                <div class="mt-6 flex justify-end gap-2">
                    <button onclick="closeModal('settingsModal')" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 interactive-scale">Cancelar</button>
                    <button onclick="applyThemeChoice()" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark interactive-scale">Aplicar</button>
                </div>
            </div>
        </div>

        <!-- Floating Notification Container -->
        <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-3 glass-morphism p-2 rounded-xl"></div>
        <div id="mobileActionBar" class="fixed bottom-0 inset-x-0 z-40 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between sm:hidden hidden">
            <button onclick="backToSelection()" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300">Voltar</button>
            <button onclick="saveInspection()" class="px-6 py-2 bg-primary text-white rounded-md interactive-scale">Salvar</button>
        </div>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section-content">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Dashboard</h2>
                    <p class="text-gray-600 dark:text-gray-400">Visão geral das inspeções e manutenções</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total de Inspeções</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white" id="totalInspecoes">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Inspeções Hoje</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white" id="inspecoesHoje">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Equipamentos Ativos</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white" id="equipamentosAtivos">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Nível Médio</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white" id="nivelMedio">0%</p>
                                </div>
                                <div class="ml-auto">
                                    <svg width="48" height="48">
                                        <circle stroke="#e5e7eb" stroke-width="6" fill="transparent" r="20" cx="24" cy="24"></circle>
                                        <circle id="nivelMedioCircle" stroke="#10B981" stroke-width="6" fill="transparent" r="20" cx="24" cy="24" stroke-dasharray="125.6" stroke-dashoffset="125.6"></circle>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700">
                        <div class="p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-teal-100 dark:bg-teal-900 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Taxa Hoje</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white" id="taxaHoje">0%</p>
                                </div>
                                <div class="ml-auto">
                                    <svg width="48" height="48">
                                        <circle stroke="#e5e7eb" stroke-width="6" fill="transparent" r="20" cx="24" cy="24"></circle>
                                        <circle id="taxaHojeCircle" stroke="#10B981" stroke-width="6" fill="transparent" r="20" cx="24" cy="24" stroke-dasharray="125.6" stroke-dashoffset="125.6"></circle>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 mb-8 card-hover">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Tendência de Aprovação (7 últimos)</h3>
                    </div>
                    <div class="p-6">
                        <canvas id="inspecoesSparkline" height="60"></canvas>
                    </div>
                </div>

                <!-- Recent Inspections & Equipment Types -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Recent Inspections -->
                    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Inspeções Recentes</h3>
                        </div>
                        <div class="p-6">
                            <div id="inspecoesRecentes" class="space-y-4">
                                <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                                    <svg class="mx-auto h-12 w-12 text-gray-300 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                    </svg>
                                    <p class="mt-2">Nenhuma inspeção realizada ainda</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Equipment Types -->
                    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Tipos de Equipamentos</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2v0a2 2 0 01-2-2v-2a2 2 0 00-2-2H8z"/>
                                            </svg>
                                        </div>
                                        <span class="text-gray-900 dark:text-white font-medium">Caminhões</span>
                                    </div>
                                    <span class="text-2xl font-bold text-gray-900 dark:text-white" id="countCaminhoes">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                            </svg>
                                        </div>
                                        <span class="text-gray-900 dark:text-white font-medium">Tratores</span>
                                    </div>
                                    <span class="text-2xl font-bold text-gray-900 dark:text-white" id="countTratores">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                            </svg>
                                        </div>
                                        <span class="text-gray-900 dark:text-white font-medium">Colhedoras</span>
                                    </div>
                                    <span class="text-2xl font-bold text-gray-900 dark:text-white" id="countColhedoras">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2v0a2 2 0 01-2-2v-2a2 2 0 00-2-2H8z"/>
                                            </svg>
                                        </div>
                                        <span class="text-gray-900 dark:text-white font-medium">Reboques</span>
                                    </div>
                                    <span class="text-2xl font-bold text-gray-900 dark:text-white" id="countReboques">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Nova Inspeção Section -->
            <section id="nova-inspecao" class="section-content hidden">
                <!-- Equipment Selection -->
                <div id="equipmentSelection">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Nova Inspeção</h2>
                        <p class="text-gray-600 dark:text-gray-400">Selecione o tipo de equipamento para iniciar a inspeção</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div onclick="selectEquipment('caminhao')" class="equipment-card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2v0a2 2 0 01-2-2v-2a2 2 0 00-2-2H8z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Caminhão</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Checklist completo para liberação de caminhões</p>
                                </div>
                            </div>
                        </div>

                        <div onclick="selectEquipment('trator')" class="equipment-card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Trator</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Checklist para liberação de tratores agrícolas</p>
                                </div>
                            </div>
                        </div>

                        <div onclick="selectEquipment('colhedora')" class="equipment-card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Colhedora</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Checklist para colhedoras de cana</p>
                                </div>
                            </div>
                        </div>

                        <div onclick="selectEquipment('plantadora')" class="equipment-card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-teal-100 dark:bg-teal-900 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12M6 12h12"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Plantadora de Cana</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Checklist de reforma/entressafra</p>
                                </div>
                            </div>
                        </div>

                        <div onclick="selectEquipment('distribuidora')" class="equipment-card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-cyan-100 dark:bg-cyan-900 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-cyan-600 dark:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Distribuidora de Cana</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Checklist de reforma/entressafra</p>
                                </div>
                            </div>
                        </div>

                        <div onclick="selectEquipment('reboque')" class="equipment-card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2v0a2 2 0 01-2-2v-2a2 2 0 00-2-2H8z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Reboque</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Checklist para reboques e semi-reboques</p>
                                </div>
                            </div>
                        </div>

                        <div onclick="selectEquipment('manutencao')" class="equipment-card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Manutenção</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Checklists de reforma e entressafra</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Checklist Form -->
                <div id="checklistForm" class="hidden">
                    <div class="mb-6">
                        <button onclick="backToSelection()" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                            </svg>
                            Voltar à seleção
                        </button>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white" id="checklistTitle">Checklist</h3>
                        </div>
                <div class="p-6">
                    <!-- Form Fields -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data</label>
                                    <input type="date" id="dataInspecao" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Frota</label>
                                    <div class="flex gap-2">
                                        <select id="frotaSelect" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                            <option value="">Selecione uma frota</option>
                                            <option value="custom">Outro (digitar)</option>
                                        </select>
                                        <button type="button" onclick="showSection('equipamentos')" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">Gerenciar</button>
                                    </div>
                                    <input type="text" id="frotaCustom" placeholder="Digite a identificação da frota" class="mt-2 hidden w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Líder</label>
                            <input type="text" id="mecanico" placeholder="Nome do líder responsável" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>

                            <!-- Checklist Items -->
                            <div class="mb-8">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Itens de Verificação</h4>
                                <div id="checklistItems" class="space-y-3">
                                    <!-- Dynamic checklist items will be inserted here -->
                                </div>
                            </div>

                            <!-- Results Summary -->
                            <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-6 mb-6">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Resultado da Inspeção</h4>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="itensOK">0</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Itens OK</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-red-600 dark:text-red-400" id="itensNaoOK">0</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Itens NÃO OK</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-primary" id="percentual">0%</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Percentual</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white" id="nivelManutencao">Nível de Manutenção: -</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button onclick="clearForm()" class="px-6 py-3 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200">
                                    Limpar
                                </button>
                                <button onclick="saveInspection()" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors duration-200 font-medium interactive-scale">
                                    Salvar Inspeção
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Histórico Section -->
            <section id="historico" class="section-content hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Histórico de Inspeções</h2>
                    <p class="text-gray-600 dark:text-gray-400">Consulte e gerencie inspeções anteriores</p>
                </div>

                <!-- Filters -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Equipamento</label>
                            <select id="filtroTipo" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Todos</option>
                                <option value="caminhao">Caminhão</option>
                                <option value="trator">Trator</option>
                                <option value="colhedora">Colhedora</option>
                                <option value="reboque">Reboque</option>
                                <option value="manutencao">Manutenção</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Inicial</label>
                            <input type="date" id="filtroDataInicial" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Final</label>
                            <input type="date" id="filtroDataFinal" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div class="flex items-end">
                            <button onclick="filterHistory()" class="w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors duration-200">
                                Filtrar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- History Table -->
                <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Equipamento</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Frota</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Líder</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nível</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="7" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                        <svg class="mx-auto h-12 w-12 text-gray-300 dark:text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                        Nenhuma inspeção encontrada
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="section-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-3">Analytics Avançado</h2>
                    <p class="text-gray-600 dark:text-gray-400">Insights detalhados sobre performance e tendências</p>
                </div>

                <!-- Advanced Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm font-medium">Taxa de Aprovação</p>
                                <p class="text-3xl font-bold" id="approvalRate">85%</p>
                                <p class="text-blue-200 text-xs mt-1">↑ 12% vs mês anterior</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm font-medium">Tempo Médio</p>
                                <p class="text-3xl font-bold" id="avgTime">15min</p>
                                <p class="text-green-200 text-xs mt-1">↓ 5min vs mês anterior</p>
                            </div>
                            <div class="w-12 h-12 bg-green-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 p-6 rounded-xl text-white card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-100 text-sm font-medium">Críticos</p>
                                <p class="text-3xl font-bold" id="criticalCountCard">3</p>
                                <p class="text-yellow-200 text-xs mt-1">Requerem atenção</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.268 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm font-medium">Produtividade</p>
                                <p class="text-3xl font-bold" id="productivity">92%</p>
                                <p class="text-purple-200 text-xs mt-1">Meta: 90%</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Performance Chart -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 card-hover">
                        <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Performance Mensal</h3>
                            <div class="flex flex-wrap items-center gap-3">
                                <select id="chartPeriod" class="text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-1">
                                    <option value="7">Últimos 7 dias</option>
                                    <option value="30" selected>Últimos 30 dias</option>
                                    <option value="90">Últimos 90 dias</option>
                                </select>
                                <select id="equipmentFilter" class="text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-1">
                                    <option value="all" selected>Todos equipamentos</option>
                                    <option value="caminhao">Caminhão</option>
                                    <option value="trator">Trator</option>
                                    <option value="colhedora">Colhedora</option>
                                    <option value="reboque">Reboque</option>
                                    <option value="manutencao">Manutenção</option>
                                </select>
                                <select id="leaderFilter" class="text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-1">
                                    <option value="all" selected>Todos líderes</option>
                                </select>
                                <button id="clearAnalyticsFilters" class="text-sm px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">Limpar</button>
                            </div>
                        </div>
                        <div class="relative h-40 sm:h-64">
                            <canvas id="performanceChart"></canvas>
                        </div>
                        <div class="mt-3 flex justify-end">
                            <button onclick="downloadChart('performanceChart', 'performance')" class="text-xs px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">Baixar gráfico</button>
                        </div>
                    </div>

                    <!-- Equipment Distribution Chart -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 card-hover">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Distribuição por Equipamento</h3>
                        <div class="relative h-40 sm:h-64">
                            <canvas id="equipmentChart"></canvas>
                        </div>
                        <div class="mt-3 flex justify-end">
                            <button onclick="downloadChart('equipmentChart', 'equipamentos')" class="text-xs px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">Baixar gráfico</button>
                        </div>
                    </div>
                </div>

                <!-- Detailed Analytics -->
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                    <!-- Critical Issues -->
                    <div class="xl:col-span-2 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 card-hover">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Problemas Críticos</h3>
                            <span id="criticalCountBadge" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">0 ativos</span>
                        </div>
                        <div class="space-y-4" id="criticalIssues">
                            <div class="flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">Caminhão FR-001</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Sistema de freios apresentando falha crítica</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">2 horas atrás</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">Trator TR-203</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Sistema hidráulico com vazamento</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">4 horas atrás</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-orange-100 dark:bg-orange-900 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">Colhedora CL-105</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Sistema de corte necessita manutenção urgente</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">6 horas atrás</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Performers -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 card-hover">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Top Líderes</h3>
                        <div class="space-y-4" id="topMecanicos">
                            <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
                                        <span class="text-green-600 dark:text-green-400 font-bold text-sm">1</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">João Silva</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">28 inspeções</p>
                                    </div>
                                </div>
                                <span class="text-green-600 dark:text-green-400 font-bold">96%</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                                        <span class="text-blue-600 dark:text-blue-400 font-bold text-sm">2</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Carlos Santos</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">22 inspeções</p>
                                    </div>
                                </div>
                                <span class="text-blue-600 dark:text-blue-400 font-bold">94%</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center">
                                        <span class="text-purple-600 dark:text-purple-400 font-bold text-sm">3</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Maria Oliveira</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">19 inspeções</p>
                                    </div>
                                </div>
                                <span class="text-purple-600 dark:text-purple-400 font-bold">92%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Relatórios Section -->
            <section id="relatorios" class="section-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-3">Relatórios</h2>
                    <p class="text-gray-600 dark:text-gray-400">Gere e exporte relatórios personalizados</p>
                </div>

                <!-- Report Generator -->
                <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Gerador de Relatórios</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Relatório</label>
                            <select id="reportType" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="geral">Relatório Geral</option>
                                <option value="equipamento">Por Equipamento</option>
                                <option value="mecanico">Por Líder</option>
                                <option value="periodo">Por Período</option>
                                <option value="criticos">Problemas Críticos</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Período</label>
                            <select id="reportPeriod" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="7">Últimos 7 dias</option>
                                <option value="30">Últimos 30 dias</option>
                                <option value="90">Últimos 90 dias</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Formato</label>
                            <select id="reportFormat" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="csv">CSV</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="generateReport()" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors duration-200 font-medium">
                            Gerar Relatório
                        </button>
                        <button onclick="scheduleReport()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                            Agendar Envio
                        </button>
                    </div>
                </div>

                <!-- Quick Reports -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white cursor-pointer card-hover" onclick="generateQuickReport('summary')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-blue-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold">Resumo Executivo</h3>
                                <p class="text-blue-200 text-sm">Visão geral das operações</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white cursor-pointer card-hover" onclick="generateQuickReport('performance')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-green-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold">Performance</h3>
                                <p class="text-green-200 text-sm">Análise de produtividade</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-red-500 to-red-600 p-6 rounded-xl text-white cursor-pointer card-hover" onclick="generateQuickReport('maintenance')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-red-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.268 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold">Manutenções</h3>
                                <p class="text-red-200 text-sm">Relatório de problemas</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white cursor-pointer card-hover" onclick="generateQuickReport('trends')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-purple-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold">Tendências</h3>
                                <p class="text-purple-200 text-sm">Análise temporal</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 p-6 rounded-xl text-white cursor-pointer card-hover" onclick="generateQuickReport('compliance')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-yellow-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold">Conformidade</h3>
                                <p class="text-yellow-200 text-sm">Relatório de compliance</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 p-6 rounded-xl text-white cursor-pointer card-hover" onclick="generateQuickReport('costs')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-indigo-400 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold">Custos</h3>
                                <p class="text-indigo-200 text-sm">Análise financeira</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Equipamentos Section -->
            <section id="equipamentos" class="section-content hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Cadastro de Equipamentos</h2>
                    <p class="text-gray-600 dark:text-gray-400">Cadastre frotas por setor para uso nas inspeções</p>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Novo Equipamento</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Setor</label>
                            <select id="equipTipo" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="caminhao">Caminhão</option>
                                <option value="trator">Trator</option>
                                <option value="colhedora">Colhedora</option>
                                <option value="plantadora">Plantadora</option>
                                <option value="distribuidora">Distribuidora</option>
                                <option value="reboque">Reboque</option>
                                <option value="manutencao">Manutenção</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Frota</label>
                            <input type="text" id="equipFrota" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Descrição</label>
                            <input type="text" id="equipDesc" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                            <select id="equipStatus" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="ativo" selected>Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="addEquipment()" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors duration-200 font-medium">Salvar</button>
                        <button onclick="populateEquipmentList()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">Atualizar Lista</button>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Frotas Cadastradas</h3>
                            <select id="equipFilterTipo" class="text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-1">
                                <option value="all" selected>Todos</option>
                                <option value="caminhao">Caminhão</option>
                                <option value="trator">Trator</option>
                                <option value="colhedora">Colhedora</option>
                                <option value="plantadora">Plantadora</option>
                                <option value="distribuidora">Distribuidora</option>
                                <option value="reboque">Reboque</option>
                                <option value="manutencao">Manutenção</option>
                                <option value="outros">Outros</option>
                            </select>
                    </div>
                    <div id="equipList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
            </section>
        </main>

        <!-- Success Modal -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4 fade-in">
                <div class="flex items-center space-x-3 mb-4">
                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Sucesso!</h3>
                </div>
                <p class="text-gray-600 dark:text-gray-400 mb-4" id="successMessage">Inspeção salva com sucesso!</p>
                <button onclick="closeModal('successModal')" class="w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors duration-200">
                    OK
                </button>
            </div>
        </div>
        <div id="inspectionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-50 hidden p-4">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full sm:max-w-2xl max-h-[80vh] sm:max-h-[85vh] overflow-y-auto mx-0 sm:mx-4 fade-in">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Checklist Completo</h3>
                    <div class="flex gap-2">
                        <button id="printInspectionBtn" class="px-3 py-2 bg-primary text-white rounded-md">Imprimir</button>
                        <button onclick="closeModal('inspectionModal')" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300">Fechar</button>
                    </div>
                </div>
                <div id="inspectionDetails" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do Supabase
        const SUPABASE_URL = 'https://orryqrjtzsvsvahsczse.supabase.co'; // Substitua pela sua URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ycnlxcmp0enN2c3ZhaHNjenNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NTYxNjEsImV4cCI6MjA3OTUzMjE2MX0.4Z0Np0DkRvO1vOowihV_La5xSIbZttaJOxY7kMOmfgI'; // Substitua pela sua chave
        
        // Inicializar cliente Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Estado global da aplicação
        let currentUser = null;
        let currentEquipment = '';
        let inspections = [];
        let equipments = [];
        let realtimeChannel = null;
        let pollingTimer = null;
        let currentInspectionId = null;
        let savingInspection = false;
        let syncingInspections = false;
        function isOnline() { return navigator.onLine; }
        function getOfflineUser() { return { id: 'offline', email: 'Offline' }; }
        function getCachedUser() { try { return JSON.parse(localStorage.getItem('currentUser')); } catch(_) { return null; } }
        function setCachedUser(u) { try { localStorage.setItem('currentUser', JSON.stringify(u)); } catch(_) {} }
        function clearCachedUser() { try { localStorage.removeItem('currentUser'); } catch(_) {} }
        function getCachedInspections() { try { return JSON.parse(localStorage.getItem('cachedInspections')) || []; } catch(_) { return []; } }
        function setCachedInspections(list) { try { localStorage.setItem('cachedInspections', JSON.stringify(list)); } catch(_) {} }
        function getPendingInspections() { try { return JSON.parse(localStorage.getItem('pendingInspections')) || []; } catch(_) { return []; } }
        function setPendingInspections(list) { try { localStorage.setItem('pendingInspections', JSON.stringify(list)); } catch(_) {} }
        function queueInspection(item) { const q = getPendingInspections(); q.push(item); setPendingInspections(q); }
        function getCachedEquipments() { try { return JSON.parse(localStorage.getItem('cachedEquipments')) || []; } catch(_) { return []; } }
        function setCachedEquipments(list) { try { localStorage.setItem('cachedEquipments', JSON.stringify(list)); } catch(_) {} }
        function getPendingEquipments() { try { return JSON.parse(localStorage.getItem('pendingEquipments')) || []; } catch(_) { return []; } }
        function setPendingEquipments(list) { try { localStorage.setItem('pendingEquipments', JSON.stringify(list)); } catch(_) {} }
        function queueEquipment(item) { const q = getPendingEquipments(); q.push(item); setPendingEquipments(q); }
        function getCachedNotifications() { try { return JSON.parse(localStorage.getItem('cachedNotifications')) || []; } catch(_) { return []; } }
        function setCachedNotifications(list) { try { localStorage.setItem('cachedNotifications', JSON.stringify(list)); } catch(_) {} }
        function addOrReplaceInspection(item) {
            const k = String(item.local_id || item.id || '');
            if (!k) {
                inspections.unshift(item);
                setCachedInspections(inspections);
                return;
            }
            const idx = inspections.findIndex(i => String(i.local_id || i.id || '') === k);
            if (idx >= 0) {
                inspections[idx] = item;
            } else {
                inspections.unshift(item);
            }
            setCachedInspections(inspections);
        }
        function dedupeInspections(list) {
            const seen = new Set();
            const out = [];
            for (const it of (list || [])) {
                const k = String(it.local_id || it.id || [it.data, it.tipo, it.frota, it.mecanico, it.created_at].join('|'));
                if (seen.has(k)) continue;
                seen.add(k);
                out.push(it);
            }
            return out;
        }
        async function seedTrucks() {
            if (!isOnline()) return;
            const trucks = [
                { tipo: 'truck', frota: '4786', descricao: 'QTR-5685', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '4787', descricao: 'QTR-5835', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6134', descricao: 'OMS-7B81', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6135', descricao: 'OMS-6J71', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6137', descricao: 'OMS-6891', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6138', descricao: 'OMS-6831', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6139', descricao: 'OMS-6I61', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6141', descricao: 'OMS-7E81', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6143', descricao: 'OMS-7B91', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6145', descricao: 'OMS-7F61', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6146', descricao: 'OMS-7F51', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6147', descricao: 'OMS-7F41', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6148', descricao: 'OMS-7F21', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6150', descricao: 'OMS-7H91', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6154', descricao: 'OMS-7651', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6155', descricao: 'OMS-7G31', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6416', descricao: 'PQS-4D11', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6418', descricao: 'PQS-4471', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6419', descricao: 'PQS-4F01', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6531', descricao: 'PRI-9R55', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6532', descricao: 'PRJ-7885', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6581', descricao: 'PRR-4C81', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6650', descricao: 'RCC-2I73', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6657', descricao: 'SCK-4B02', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6658', descricao: 'SCK-3J22', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6679', descricao: 'SBY-6F31', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6680', descricao: 'SBY-6F71', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6681', descricao: 'SBZ-0G11', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6682', descricao: 'SBY-6E21', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6697', descricao: 'SDC-3G12', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6698', descricao: 'SDC-3G22', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6699', descricao: 'SCW-7B53', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6700', descricao: 'SCW7C53', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6960', descricao: 'SDI-6F74', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6961', descricao: 'SDI-6C04', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6962', descricao: 'SDI-6F04', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6963', descricao: 'SDI-6A84', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6964', descricao: 'SDI-6D54', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6965', descricao: 'SDI-5J84', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6995', descricao: 'TFW-1G13', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6996', descricao: 'TFT-6D23', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6997', descricao: 'TFN-0G73', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6998', descricao: 'TFR-0E43', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'truck', frota: '6999', descricao: 'TGD-6H83', status: 'ativo', created_at: new Date().toISOString() }
            ];
            const frotas = trucks.map(t => t.frota);
            const { data: existing, error } = await supabase
                .from('equipments')
                .select('frota,tipo')
                .eq('tipo', 'truck')
                .in('frota', frotas);
            if (error) return;
            const existingSet = new Set((existing || []).map(e => String(e.frota)));
            const toInsert = trucks.filter(t => !existingSet.has(String(t.frota)));
            if (toInsert.length === 0) return;
            const { error: insErr } = await supabase
                .from('equipments')
                .insert(toInsert);
            if (!insErr) {
                await loadEquipments();
                populateEquipmentList();
                showFloatingNotification('success', 'Frotas de caminhão cadastradas');
            }
        }
        async function seedHarvesters() {
            if (!isOnline()) return;
            const list = [
                { tipo: 'colhedora', frota: '6602', descricao: 'Colhedora', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'colhedora', frota: '6988', descricao: 'Colhedora', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'colhedora', frota: '6989', descricao: 'Colhedora', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'colhedora', frota: '6721', descricao: 'Colhedora', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'colhedora', frota: '6990', descricao: 'Colhedora', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'colhedora', frota: '6722', descricao: 'Colhedora', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'colhedora', frota: '6702', descricao: 'Colhedora', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'colhedora', frota: '5911', descricao: 'colhedora', status: 'ativo', created_at: new Date().toISOString() }
            ];
            const frotas = list.map(t => t.frota);
            const { data: existing, error } = await supabase
                .from('equipments')
                .select('frota,tipo')
                .eq('tipo', 'colhedora')
                .in('frota', frotas);
            if (error) return;
            const existingSet = new Set((existing || []).map(e => String(e.frota)));
            const toInsert = list.filter(t => !existingSet.has(String(t.frota)));
            if (toInsert.length === 0) return;
            const { error: insErr } = await supabase
                .from('equipments')
                .insert(toInsert);
            if (!insErr) {
                await loadEquipments();
                populateEquipmentList();
                showFloatingNotification('success', 'Colhedoras cadastradas');
            }
        }
        async function seedTractors() {
            if (!isOnline()) return;
            const list = [
                { tipo: 'trator', frota: '6671', descricao: 'MF-Dyna', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6685', descricao: 'MF-Dyna', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6958', descricao: 'MF-Dyna', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6966', descricao: 'JHON DEERE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6967', descricao: 'JHON DEERE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6969', descricao: 'JHON DEERE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6668', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6669', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6670', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6617', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6968', descricao: 'JHON DEERE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6616', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6615', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6525', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6527', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6526', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6528', descricao: 'MF-7219', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6611', descricao: 'JHON DEERE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6612', descricao: 'JHON DEERE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6459', descricao: 'MF 7415', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6083', descricao: 'MF-4299', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6365', descricao: '', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6019', descricao: 'MF-7180', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6458', descricao: 'MF-7415', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6069', descricao: 'MF-4283', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6071', descricao: 'MF-4283', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'trator', frota: '6367', descricao: 'MF-4283', status: 'ativo', created_at: new Date().toISOString() }
            ];
            const frotas = list.map(t => t.frota);
            const { data: existing, error } = await supabase
                .from('equipments')
                .select('frota,tipo')
                .eq('tipo', 'trator')
                .in('frota', frotas);
            if (error) return;
            const existingSet = new Set((existing || []).map(e => String(e.frota)));
            const toInsert = list.filter(t => !existingSet.has(String(t.frota)));
            if (toInsert.length === 0) return;
            const { error: insErr } = await supabase
                .from('equipments')
                .insert(toInsert);
            if (!insErr) {
                await loadEquipments();
                populateEquipmentList();
                showFloatingNotification('success', 'Tratores cadastrados');
            }
        }
        async function seedPlanters() {
            if (!isOnline()) return;
            const list = [
                { tipo: 'plantadora', frota: '6474', descricao: 'ANTONIOSE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'plantadora', frota: '6476', descricao: 'ANTONIOSE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'plantadora', frota: '6473', descricao: 'ANTONIOSE', status: 'ativo', created_at: new Date().toISOString() }
            ];
            const frotas = list.map(t => t.frota);
            const { data: existing, error } = await supabase
                .from('equipments')
                .select('frota,tipo')
                .eq('tipo', 'plantadora')
                .in('frota', frotas);
            if (error) return;
            const existingSet = new Set((existing || []).map(e => String(e.frota)));
            const toInsert = list.filter(t => !existingSet.has(String(t.frota)));
            if (toInsert.length === 0) return;
            const { error: insErr } = await supabase
                .from('equipments')
                .insert(toInsert);
            if (!insErr) {
                await loadEquipments();
                populateEquipmentList();
                showFloatingNotification('success', 'Plantadoras cadastradas');
            }
        }
        async function seedDistributors() {
            if (!isOnline()) return;
            const list = [
                { tipo: 'distribuidora', frota: '5530', descricao: 'ANTONIOSE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'distribuidora', frota: '5684', descricao: 'ANTONIOSE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'distribuidora', frota: '4332', descricao: 'ANTONIOSE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'distribuidora', frota: '5812', descricao: 'ANTONIOSE', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'distribuidora', frota: '4105', descricao: 'COBRIDOR', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'distribuidora', frota: '6315', descricao: 'COBRIDOR', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'distribuidora', frota: '6316', descricao: 'COBRIDOR', status: 'ativo', created_at: new Date().toISOString() }
            ];
            const frotas = list.map(t => t.frota);
            const { data: existing, error } = await supabase
                .from('equipments')
                .select('frota,tipo')
                .eq('tipo', 'distribuidora')
                .in('frota', frotas);
            if (error) return;
            const existingSet = new Set((existing || []).map(e => String(e.frota)));
            const toInsert = list.filter(t => !existingSet.has(String(t.frota)));
            if (toInsert.length === 0) return;
            const { error: insErr } = await supabase
                .from('equipments')
                .insert(toInsert);
            if (!insErr) {
                await loadEquipments();
                populateEquipmentList();
                showFloatingNotification('success', 'Distribuidoras cadastradas');
            }
        }
        async function seedTrailers() {
            if (!isOnline()) return;
            const list = [
                { tipo: 'reboque', frota: '4371', descricao: 'Grupo 2 - OML-0082', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4373', descricao: 'Grupo 2 - OMK-9982', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4377', descricao: 'Grupo 2 - OML-5602', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4615', descricao: 'Grupo 1 - PQU-2651', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4619', descricao: 'Grupo 1 - PQU-2701', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4621', descricao: 'Grupo 1 - PQU-0271', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4631', descricao: 'Grupo 1 - PQU-2561', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4632', descricao: 'Grupo 1 - PQT-3481', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4645', descricao: 'Grupo 1 - PQU-4991', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4648', descricao: 'Grupo 1 - PQU-4721', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '4653', descricao: 'Grupo 1 - PQU-5161', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6181', descricao: 'Grupo 2 - OMK-3I32', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6182', descricao: 'Grupo 2 - OMK-3452', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6183', descricao: 'Grupo 2 - OMK-3472', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6184', descricao: 'Grupo 2 - OMK-9842', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6185', descricao: 'Grupo 2 - OMK-3842', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6186', descricao: 'Grupo 2 - OML-4B82', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6187', descricao: 'Grupo 2 - OMK3H02', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6188', descricao: 'Grupo 2 - OMK-3352', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6190', descricao: 'Grupo 2 - OML-5D22', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6191', descricao: 'Grupo 2 - OML-4882', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6193', descricao: 'Grupo 2 - OML-4802', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6194', descricao: 'Grupo 2 - OML-4152', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6195', descricao: 'Grupo 2 - OMK-3E12', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6196', descricao: 'Grupo 2 - OML-4212', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6197', descricao: 'Grupo 2 - OML-3J42', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6198', descricao: 'Grupo 2 - OMK-3J12', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6199', descricao: 'Grupo 2 - OMK-3H12', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6201', descricao: 'Grupo 2 - ONF-2I51', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6202', descricao: 'Grupo 2 - OML-4162', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6207', descricao: 'Grupo 2 - OML-4932', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6209', descricao: 'Grupo 2 - OML-5012', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6210', descricao: 'Grupo 2 - OML-3792', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6213', descricao: 'Grupo 2 - OML-4112', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6214', descricao: 'Grupo 2 - OML-4822', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6218', descricao: 'Grupo 2 - OMK-3I52', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6221', descricao: 'Grupo 2 - OMK-4B72', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6222', descricao: 'Grupo 2 - OML-4C72', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6224', descricao: 'Grupo 2 - OML-4J42', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6225', descricao: 'Grupo 2 - OML-4282', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6226', descricao: 'Grupo 2 - OML-3912', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6239', descricao: 'Grupo 2 - OML-3J32', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6241', descricao: 'Grupo 2 - OMK-3I82', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6242', descricao: 'Grupo 2 - OML-5D92', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6388', descricao: 'Grupo 1 - PQT-4811', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6389', descricao: 'Grupo 1 - PQT-5681', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6390', descricao: 'Grupo 1 - PQT-4941', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6391', descricao: 'Grupo 1 - PQT-5761', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6392', descricao: 'Grupo 1 - PQT-4721', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6393', descricao: 'Grupo 1 - PQT-5721', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6394', descricao: 'Grupo 1 - PQT-4781', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6395', descricao: 'Grupo 1 - PQT-5711', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6396', descricao: 'Grupo 1 - PQT-4881', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6397', descricao: 'Grupo 1 - PQT-5661', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6398', descricao: 'Grupo 1 - PQT-4991', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6399', descricao: 'Grupo 1 - PQT-5771', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6400', descricao: 'Grupo 1 - PQT-5171', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6401', descricao: 'Grupo 1 - PQT-5851', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6402', descricao: 'Grupo 1 - PQT-4931', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6403', descricao: 'Grupo 1 - PQT-5731', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6404', descricao: 'Grupo 1 - PQT-5061', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6405', descricao: 'Grupo 1 - PQT-5831', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6406', descricao: 'Grupo 1 - PQT-5041', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6407', descricao: 'Grupo 1 - PQT-5821', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6408', descricao: 'Grupo 1 - PQT-4961', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6409', descricao: 'Grupo 1 - PQT-5801', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6412', descricao: 'Grupo 1 - PQT-5031', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6413', descricao: 'Grupo 1 - PQT-5641', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6421', descricao: 'Grupo 1 - PQU-2741', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6422', descricao: 'Grupo 1 - PQU-2811', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6423', descricao: 'Grupo 1 - PQJ-8042', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6424', descricao: 'Grupo 1 - PQU-2521', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6425', descricao: 'Grupo 1 - PQU-2791', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6426', descricao: 'Grupo 1 - PQU-2801', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6427', descricao: 'Grupo 1 - PQU-2691', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6428', descricao: 'Grupo 1 - PQU-2821', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6429', descricao: 'Grupo 1 - PQU-2781', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6430', descricao: 'Grupo 1 - PQU-2731', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6431', descricao: 'Grupo 1 - PQU-2H61', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6432', descricao: 'Grupo 1 - PQU-3031', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6433', descricao: 'Grupo 1 - PQU-3021', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '6434', descricao: 'Grupo 1 - PQU-2711', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '9492', descricao: 'Grupo 2 - NKI-6386', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '9501', descricao: 'Grupo 2 - NKI-6F16', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '9542', descricao: 'Grupo 2 - NWF-7I74', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '9546', descricao: 'Grupo 2 - NWF-8644', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '30014', descricao: 'Grupo 3 - OOD3F98', status: 'ativo', created_at: new Date().toISOString() },
                { tipo: 'reboque', frota: '30015', descricao: 'Grupo 3 - OOD4H78', status: 'ativo', created_at: new Date().toISOString() }
            ];
            const frotas = list.map(t => t.frota);
            const { data: existing, error } = await supabase
                .from('equipments')
                .select('frota,tipo')
                .eq('tipo', 'reboque')
                .in('frota', frotas);
            if (error) return;
            const existingSet = new Set((existing || []).map(e => String(e.frota)));
            const toInsert = list.filter(t => !existingSet.has(String(t.frota)));
            if (toInsert.length === 0) return;
            const { error: insErr } = await supabase
                .from('equipments')
                .insert(toInsert);
            if (!insErr) {
                await loadEquipments();
                populateEquipmentList();
                showFloatingNotification('success', 'Reboques cadastrados');
            }
        }
        let currentInspection = {
            items: [],
            results: {ok: 0, notOk: 0, percentage: 0}
        };

        // Equipment checklists
        const equipmentConfigs = {
            truck: {
                title: "Checklist de Liberação - Caminhão",
                sections: [
                    {
                        name: "CABINE",
                        items: [
                            "Bucha da suspensão",
                            "Batente e dobradiça portas",
                            "Borrachas das portas",
                            "Palhetas do limpador para-brisa",
                            "Maçanetas (internas/externas) e manivela dos vidros",
                            "Bancos (motorista e passageiro)",
                            "Conjunto de basculamento da cabine",
                            "Reservatório e mangueira do limpador de para-brisa",
                            "Estado da escada",
                            "Estado dos retrovisores e paralama dianteiro"
                        ]
                    },
                    {
                        name: "CHASSI",
                        items: [
                            "Trincas no chassi e travessas",
                            "Rampa e quinta roda",
                            "Suportes de fixação (tq combustível, bateria, tq arla)",
                            "Danos paralamas traseiros",
                            "Danos e fixação do para barro",
                            "Trincas e fixação da boca de lobo",
                            "Parafuso de fixação do implemento",
                            "Plataformas e suportes dos cones"
                        ]
                    },
                    {
                        name: "MOTOR",
                        items: [
                            "Radiadores, reservatório de água e intercooler",
                            "Tensores de correia, roletes e polias",
                            "Mangueiras e abraçadeiras do sist. de arrefecimento",
                            "Mangueiras e abraçadeiras do sist. de admissão e intercooler",
                            "Regulagem de válvulas do motor e vazamentos (água/diesel/lub)",
                            "Coxins do motor",
                            "Protetores e fixação do silencioso",
                            "Folga no eixo da turbina ou vazamentos",
                            "Carcaça do filtro e tubulação de ar"
                        ]
                    },
                    {
                        name: "SISTEMA ELÉTRICO",
                        items: [
                            "Sinalização traseira e dianteira",
                            "Faróis e piscas",
                            "Chicotes elétricos",
                            "Luzes do painel",
                            "Alternador, correia e tensor",
                            "Ventilador, correia e tensor",
                            "Funcionamento dos vidros",
                            "Ar condicionado",
                            "Ventilador e distribuição do ar",
                            "Funcionamento do limpador de para-brisa",
                            "Motor de partida"
                        ]
                    },
                    {
                        name: "TRANSMISSÃO",
                        items: [
                            "Embreagem (folga/funcionamento)",
                            "Caixa de câmbio (vazamentos/ruídos)",
                            "Cardans e cruzetas",
                            "Acoplamentos e flanges",
                            "Diferencial (fixação/vazamentos)",
                            "Semieixos e juntas",
                            "Suportes e coxins da transmissão"
                        ]
                    },
                    {
                        name: "EIXO DIANTEIRO",
                        items: [
                            "Rolamentos e cubos",
                            "Manga de eixo",
                            "Amortecedores",
                            "Molas/feixes e fixações",
                            "Barra estabilizadora",
                            "Barra de direção e terminais",
                            "Geometria/folgas de direção"
                        ]
                    },
                    {
                        name: "EIXO TRASEIRO",
                        items: [
                            "Molas/feixes e fixações",
                            "Amortecedores",
                            "Braços/estabilizadores",
                            "Rolamentos e cubos",
                            "Eixo/diferencial (ruídos/vazamentos)"
                        ]
                    },
                    {
                        name: "SISTEMA PNEUMÁTICO",
                        items: [
                            "Reservatórios de ar",
                            "Válvulas e conexões",
                            "Mangueiras e flexíveis",
                            "Câmaras de freio",
                            "Tubulações do sistema",
                            "Vazamentos/pressão"
                        ]
                    },
                    {
                        name: "DIREÇÃO",
                        items: [
                            "Bomba da direção",
                            "Caixa de direção",
                            "Mangueiras e vazamentos",
                            "Folgas no sistema",
                            "Alinhamento/funcionamento"
                        ]
                    }
                ]
            },
            tractor: {
                title: "Checklist de Liberação - Trator",
                sections: [
                    {
                        name: "SISTEMA DO MOTOR",
                        items: [
                            "Correias e polias",
                            "Tensores",
                            "Bomba d'água",
                            "Turbina",
                            "Anéis e vedações",
                            "Bomba injetora",
                            "Bicos injetores",
                            "Mangotes",
                            "Radiadores",
                            "Trincas/Desgaste"
                        ]
                    },
                    {
                        name: "SISTEMA ELÉTRICO",
                        items: [
                            "Alternador",
                            "Bóia do tanque",
                            "Buzina",
                            "Rádio de comunicação",
                            "Ar condicionado",
                            "Faróis",
                            "Relógios em geral",
                            "Chicotes elétricos",
                            "Painel de Instrumentos",
                            "Bateria"
                        ]
                    },
                    {
                        name: "CHASSI E CABINE",
                        items: [
                            "Trincas",
                            "Desgaste",
                            "Fixação",
                            "Banco",
                            "Painel de Instrumentos",
                            "Alavancas e manoplas",
                            "Retrovisor"
                        ]
                    },
                    {
                        name: "TRANSMISSÃO",
                        items: [
                            "Caixa de câmbio",
                            "Cardans e cruzetas",
                            "Acoplamentos/Flanges",
                            "Diferencial (fixação/vazamentos)",
                            "Semieixos/Juntas",
                            "Coxins/Suportes"
                        ]
                    },
                    {
                        name: "EMBREAGEM",
                        items: [
                            "Acionamento",
                            "Folga",
                            "Desgaste",
                            "Vazamentos",
                            "Ajustes"
                        ]
                    },
                    {
                        name: "DIREÇÃO",
                        items: [
                            "Bomba da direção",
                            "Caixa de direção",
                            "Mangueiras/Vazamentos",
                            "Barra/Terminais",
                            "Folgas",
                            "Alinhamento"
                        ]
                    },
                    {
                        name: "EIXO DIANTEIRO",
                        items: [
                            "Rolamentos/Cubos",
                            "Manga de eixo",
                            "Amortecedores",
                            "Molas/Feixes e fixações",
                            "Barra estabilizadora"
                        ]
                    },
                    {
                        name: "EIXO TRASEIRO",
                        items: [
                            "Molas/Feixes e fixações",
                            "Amortecedores",
                            "Braços/Estabilizadores",
                            "Rolamentos/Cubos",
                            "Eixo/Diferencial (ruídos/vazamentos)"
                        ]
                    },
                    {
                        name: "SISTEMA HIDRÁULICO",
                        items: [
                            "Reservatório e filtros",
                            "Bombas hidráulicas",
                            "Válvulas/Distribuidores",
                            "Mangueiras/Flexíveis",
                            "Abraçadeiras/Conexões",
                            "Vazamentos/Pressão"
                        ]
                    },
                    {
                        name: "SISTEMA DE FREIO",
                        items: [
                            "Válvulas/Mangueiras",
                            "Câmaras de freio",
                            "Lonas/Pastilhas",
                            "Discos/Tambores",
                            "Nível de fluido",
                            "Reservatório de ar"
                        ]
                    },
                    {
                        name: "SISTEMA DE COMBUSTÍVEL",
                        items: [
                            "Tanque - Fixação",
                            "Tanque - Vazamentos",
                            "Bomba de combustível",
                            "Linhas/Conexões",
                            "Filtros",
                            "Tampa/vedação"
                        ]
                    },
                    {
                        name: "SISTEMA DE ARREFECIMENTO",
                        items: [
                            "Radiador",
                            "Ventiladores",
                            "Mangueiras/Abraçadeiras",
                            "Reservatório",
                            "Nível",
                            "Vazamentos"
                        ]
                    },
                    {
                        name: "SISTEMA DE LUBRIFICAÇÃO",
                        items: [
                            "Nível de óleo",
                            "Filtros",
                            "Linhas/Conexões",
                            "Pontos de graxa",
                            "Vazamentos"
                        ]
                    },
                    {
                        name: "PNEUS",
                        items: [
                            "Altura dos sulcos dos pneus",
                            "Emparelhamento de duplos",
                            "Desgaste irregular",
                            "Efetuar a calibragem dos pneus",
                            "Parafuso de roda"
                        ]
                    },
                    {
                        name: "SUSP. DIANT.",
                        items: [
                            "Alinhamento do eixo dianteiro",
                            "Balança (pino/bucha/mancal/fixação)",
                            "Feixe de mola",
                            "Braços tensores"
                        ]
                    },
                    {
                        name: "SUSP. TRAS.",
                        items: [
                            "Alinhamento do eixo traseiro",
                            "Balança (pino/bucha/mancal/fixação)",
                            "Feixe de mola",
                            "Braços tensores"
                        ]
                    },
                    {
                        name: "ESTRUTURA (SISTEMA DE LONAMENTO)",
                        items: [
                            "Braço dianteiro",
                            "Braço traseiro",
                            "Pinos",
                            "Rolamentos",
                            "Lona",
                            "Mola"
                        ]
                    },
                    {
                        name: "ADESIVOS E LACRES",
                        items: [
                            "Identificação da frota",
                            "Adesivos refletivos",
                            "Lacre da placa traseira"
                        ]
                    }
                ]
            },
            harvester: {
                title: "Checklist de Liberação - Colhedora",
                sections: [
                    {
                        name: "MOTOR DIESEL",
                        items: [
                            "Turbina - Fixação",
                            "Turbina - Vazamentos",
                            "Turbina - Funcionamento",
                            "Mangueiras/Mangotes - Fixação",
                            "Mangueiras/Mangotes - Vazamento",
                            "Mangueiras/Mangotes - Abraçadeiras",
                            "Motor - Fixação",
                            "Motor - Vazamentos",
                            "Motor - Funcionamento",
                            "Escapamento - Fixação"
                        ]
                    },
                    {
                        name: "SISTEMA ELÉTRICO",
                        items: [
                            "Correia do alternador - Alinhamento/Tensão",
                            "Correia do alternador - Cortes e rachaduras",
                            "Bóia do tanque - Fio da bóia",
                            "Buzina - Funcionamento",
                            "Rádio de comunicação",
                            "Computador de Bordo",
                            "Alarme de ré",
                            "Sensor de porta",
                            "Ar condicionado",
                            "Faróis",
                            "Chicotes e conexões"
                        ]
                    },
                    {
                        name: "MATERIAL RODANTE",
                        items: [
                            "Esteira - Tensionamento",
                            "Esteira - Desgaste",
                            "Roletes - Fixação",
                            "Roletes - Desgaste",
                            "Motores hidráulicos - Fixação",
                            "Motores hidráulicos - Vazamentos",
                            "Motores hidráulicos - Funcionamento",
                            "Sapatas/Roda Motriz - Parafusos",
                            "Sapatas/Roda Motriz - Proteção",
                            "Sapatas/Roda Motriz - Desgaste/Trincas"
                        ]
                    },
                    {
                        name: "PLATAFORMA / DIVISORES",
                        items: [
                            "Divisor de linhas - Fixação",
                            "Divisor de linhas - Ajustes",
                            "Guias e placas - Desgaste",
                            "Rolos alimentadores - Funcionamento",
                            "Rolos alimentadores - Vazamentos",
                            "Coberturas/Proteções"
                        ]
                    },
                    {
                        name: "CORTE DE BASE",
                        items: [
                            "Conjunto de facas - Fixação",
                            "Conjunto de facas - Desgaste",
                            "Altura de corte",
                            "Rolamentos/Conjuntos",
                            "Motores/Transmissão",
                            "Proteções"
                        ]
                    },
                    {
                        name: "CORTE DE PONTAS",
                        items: [
                            "Conjunto de facas - Fixação",
                            "Conjunto de facas - Desgaste",
                            "Altura/ajuste",
                            "Motores/Transmissão",
                            "Proteções"
                        ]
                    },
                    {
                        name: "ALIMENTADOR PRIMÁRIO",
                        items: [
                            "Esteira - Tensionamento",
                            "Esteira - Desgaste",
                            "Rolos - Fixação",
                            "Rolos - Desgaste",
                            "Motores/Válvulas",
                            "Guia/Proteções"
                        ]
                    },
                    {
                        name: "ALIMENTADOR SECUNDÁRIO",
                        items: [
                            "Esteira - Tensionamento",
                            "Esteira - Desgaste",
                            "Rolos - Fixação",
                            "Rolos - Desgaste",
                            "Motores/Válvulas",
                            "Guia/Proteções"
                        ]
                    },
                    {
                        name: "LIMPADOR / EXTRATOR",
                        items: [
                            "Extrator primário - Pá/desgaste",
                            "Extrator primário - Fixação",
                            "Extrator secundário - Pá/desgaste",
                            "Extrator secundário - Fixação",
                            "Motores/Válvulas",
                            "Proteções"
                        ]
                    },
                    {
                        name: "ELEVADOR",
                        items: [
                            "Correntes - Tensionamento",
                            "Correntes - Desgaste",
                            "Aletas/Pás",
                            "Trilhos/Guias",
                            "Motores/Válvulas",
                            "Proteções"
                        ]
                    },
                    {
                        name: "SISTEMA HIDRÁULICO",
                        items: [
                            "Reservatório e filtros",
                            "Bombas hidráulicas",
                            "Válvulas/Distribuidores",
                            "Mangueiras/Flexíveis",
                            "Abraçadeiras/Conexões",
                            "Vazamentos/Pressão"
                        ]
                    },
                    {
                        name: "TRANSMISSÃO HIDROSTÁTICA",
                        items: [
                            "Hidrostatic drive - Bombas",
                            "Hidrostatic drive - Motores",
                            "Acoplamentos/Flanges",
                            "Vazamentos",
                            "Fixações"
                        ]
                    },
                    {
                        name: "CABINE / COMANDOS",
                        items: [
                            "Assento/ajustes",
                            "Cintos de segurança",
                            "Painel/indicadores",
                            "Comandos/joysticks",
                            "Ar condicionado",
                            "Limpeza/visibilidade"
                        ]
                    },
                    {
                        name: "CHASSI / ESTRUTURA",
                        items: [
                            "Trincas/Desgaste",
                            "Soldas/Fixações",
                            "Pontos de apoio",
                            "Proteções",
                            "Plataformas/escadas"
                        ]
                    },
                    {
                        name: "PICADOR",
                        items: [
                            "Rotores/Facas - Fixação",
                            "Rotores/Facas - Desgaste",
                            "Balanceamento/ruídos",
                            "Rolamentos/Conjuntos",
                            "Proteções"
                        ]
                    },
                    {
                        name: "DESCARGA",
                        items: [
                            "Tubo de descarga - Fixação",
                            "Tubo de descarga - Giro/acionamento",
                            "Defletor/bica - Ajustes",
                            "Cilindros/mangueiras",
                            "Proteções"
                        ]
                    },
                    {
                        name: "GUIAMENTO / AUTOPILOTO",
                        items: [
                            "Guias/antenas",
                            "Sensores de linha",
                            "Calibração",
                            "Funcionamento",
                            "Telemetria/GPS"
                        ]
                    },
                    {
                        name: "SISTEMA DE COMBUSTÍVEL",
                        items: [
                            "Tanque - Fixação",
                            "Tanque - Vazamentos",
                            "Bomba de combustível",
                            "Linhas/Conexões",
                            "Filtros",
                            "Tampa/vedação"
                        ]
                    },
                    {
                        name: "SISTEMA DE ARREFECIMENTO",
                        items: [
                            "Radiador",
                            "Ventiladores",
                            "Mangueiras/Abraçadeiras",
                            "Reservatório",
                            "Nível",
                            "Vazamentos"
                        ]
                    },
                    {
                        name: "SISTEMA DE LUBRIFICAÇÃO",
                        items: [
                            "Nível de óleo",
                            "Filtros",
                            "Linhas/Conexões",
                            "Pontos de graxa",
                            "Vazamentos"
                        ]
                    },
                    {
                        name: "TRANSMISSÃO FINAL",
                        items: [
                            "Redutores finais",
                            "Fixações",
                            "Vazamentos",
                            "Níveis",
                            "Proteções"
                        ]
                    },
                    {
                        name: "SEGURANÇA",
                        items: [
                            "Extintor",
                            "Alarme de ré",
                            "Iluminação",
                            "Sinalização",
                            "Etiquetas/Avisos"
                        ]
                    }
                ]
            },
            planter: {
                title: "Checklist de Reforma/Entressafra - Plantadora de Cana",
                sections: [
                    {
                        name: "PRIMÁRIA",
                        items: [
                            "Lavagem geral",
                            "Lubrificação geral"
                        ]
                    },
                    {
                        name: "ALIMENTADOR DE ADUBO",
                        items: [
                            "Verificar vazamento nas mangueiras",
                            "Verificar vazamento no motor hidráulico"
                        ]
                    },
                    {
                        name: "ALIMENTADOR DE TOLETE",
                        items: [
                            "Verificar conjunto mecânico / reparar se necessário"
                        ]
                    },
                    {
                        name: "MECÂNICO",
                        items: [
                            "Corredor - reparar se necessário",
                            "Esteira - reparar se necessário",
                            "Plataforma - reparar se necessário",
                            "Rolo açamador - reparar se necessário",
                            "Tandem - reparar se necessário",
                            "Tanque"
                        ]
                    },
                    {
                        name: "ELÉTRICA",
                        items: [
                            "Verificar câmera da esteira",
                            "Verificar câmera da esteira traseira",
                            "Verificar câmera do corredor",
                            "Verificar conectores das câmeras",
                            "Verificar passagem de cabos",
                            "Verificar funcionamento do monitor das câmeras",
                            "Verificar alimentação do monitor interface",
                            "Verificar sensor rotação",
                            "Verificar sensores de fim de curso",
                            "Reparar tomada elétrica"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - ALIMENTADOR DE ADUBO",
                        items: [
                            "Verificar desgaste nas engrenagens",
                            "Verificar eixo das engrenagens",
                            "Verificar suporte do motor"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - ALIMENTADOR DE TOLETE",
                        items: [
                            "Verificar estrutura/ajustes"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - CAIXA DE ADUBO",
                        items: [
                            "Estrutura/vedações",
                            "Fixações"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - CHASSI",
                        items: [
                            "Trincas/soldas",
                            "Fixações",
                            "Nivelamento/estado"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - CORREDOR",
                        items: [
                            "Estrutura",
                            "Proteções/chapas"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - ENGATE",
                        items: [
                            "Estrutura",
                            "Pinos",
                            "Folgas"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - ESTEIRA",
                        items: [
                            "Estrutura",
                            "Guias",
                            "Proteções"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - GERAL",
                        items: [
                            "Reparos e reforços gerais",
                            "Soldas/chapas"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - PLATAFORMA",
                        items: [
                            "Estrutura",
                            "Fixações"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - ROLO DESTROÇADOR",
                        items: [
                            "Estrutura",
                            "Rolamentos",
                            "Fixações"
                        ]
                    },
                    {
                        name: "CALDEIRARIA - TANDEM",
                        items: [
                            "Estrutura",
                            "Fixações",
                            "Rolamentos"
                        ]
                    },
                    {
                        name: "PNEUS",
                        items: [
                            "Calibragem",
                            "Medição de sulco"
                        ]
                    },
                    {
                        name: "FUNILARIA",
                        items: [
                            "Adesivar",
                            "Pintura"
                        ]
                    }
                ]
            },
            distributor: {
                title: "Checklist de Reforma/Entressafra - Distribuidora de Cana",
                sections: [
                    {
                        name: "PRIMÁRIA",
                        items: [
                            "Lavagem geral",
                            "Lubrificação geral",
                            "Tandem"
                        ]
                    },
                    {
                        name: "MECÂNICO",
                        items: [
                            "Hidráulico",
                            "Inspeção",
                            "Reparar se necessário",
                            "Tandem - reparar se necessário"
                        ]
                    },
                    {
                        name: "ELÉTRICA",
                        items: [
                            "Revisar painel instrumentos/câmera",
                            "Revisar tomadas/pinos",
                            "Verificar chicotes elétricos",
                            "Verificar sinalizações e iluminação",
                            "Revisar câmera - reparar se necessário"
                        ]
                    },
                    {
                        name: "CALDEIRARIA",
                        items: [
                            "Cabeçalho - reparar se necessário"
                        ]
                    },
                    {
                        name: "PNEUS",
                        items: [
                            "Calibragem",
                            "Medição de sulco",
                            "Conferir parafusos e porcas",
                            "Reparar rodas",
                            "Revisar eixo/mancal",
                            "Reparar válvula",
                            "Balanceamento"
                        ]
                    },
                    {
                        name: "FUNILARIA",
                        items: [
                            "Pintura",
                            "Número/frota e logotipo"
                        ]
                    }
                ]
            },
            trailer: {
                title: "Checklist de Liberação - Reboque/Semi-reboque",
                sections: [
                    {
                        name: "CHASSI",
                        items: [
                            "Nivelamento, estado e solda do chassi",
                            "Suporte da placa",
                            "Suporte da corrente",
                            "Suporte do documento",
                            "Trincas geral",
                            "Trincas mesa 5° roda",
                            "Viga frontal / traseira",
                            "Vigas laterais",
                            "Mancais de basculamento",
                            "Pino rei"
                        ]
                    },
                    {
                        name: "ELÉTRICO",
                        items: [
                            "Chicote elétrico",
                            "Iluminação traseira",
                            "Iluminação lateral (esquerdo e direito)",
                            "Funcionamento e limpeza das conexões"
                        ]
                    },
                    {
                        name: "FREIO",
                        items: [
                            "Freio pneumático (válvula, mangueiras)",
                            "Flexíveis e câmaras de freio",
                            "Desgastes da lona de freio",
                            "Sistema de freio",
                            "Reservatório de ar"
                        ]
                    }
                ]
            }
        };
            manutencao: [
                'Troca de filtros',
                'Verificação de fluidos',
                'Inspeção geral da estrutura',
                'Teste de sistemas',
                'Substituição de peças',
                'Calibragem e ajustes',
                'Limpeza geral',
                'Testes de funcionalidade'
            ]
        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            checkAuthState();
            updateDateTime();
            setInterval(updateDateTime, 60000);
        });

        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            updateDateTime();
            setInterval(updateDateTime, 60000);
        });

        // Verificar estado de autenticação
        async function checkAuthState() {
            showLoading(true);
            
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    console.error('Erro ao verificar sessão:', error);
                    if (!isOnline()) {
                        const cached = getCachedUser();
                        currentUser = cached || getOfflineUser();
                        showApp();
                        return;
                    }
                    showLogin();
                    return;
                }
                
                if (session) {
                    currentUser = session.user;
                    showApp();
                } else {
                    if (!isOnline()) {
                        const cached = getCachedUser();
                        currentUser = cached || getOfflineUser();
                        showApp();
                    } else {
                        showLogin();
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar autenticação:', error);
                const cached = getCachedUser();
                if (!isOnline()) {
                    currentUser = cached || getOfflineUser();
                    showApp();
                } else {
                    if (cached) { currentUser = cached; showApp(); } else { showLogin(); }
                }
            } finally {
                showLoading(false);
            }
        }

        // Mostrar tela de login
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        // Mostrar aplicação principal
        function showApp() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userEmail').textContent = currentUser.email;
            const mech = document.getElementById('mecanico');
            if (mech) { mech.value = currentUser.email; }
            loadInitialData();
            setupRealtime();
            startPolling();
        }

        // Alternar entre login e cadastro
        function toggleAuthMode() {
            const loginForm = document.getElementById('loginForm');
            const loginTitle = document.querySelector('#loginModal h2');
            const loginButton = loginForm.querySelector('button[type="submit"]');
            const toggleText = document.querySelector('#loginModal .text-center p');
            
            if (loginForm.getAttribute('data-mode') === 'login') {
                // Mudar para modo cadastro
                loginForm.setAttribute('data-mode', 'signup');
                loginTitle.textContent = 'Criar Conta';
                loginButton.textContent = 'Cadastrar';
                toggleText.innerHTML = 'Já tem uma conta? <button onclick="toggleAuthMode()" class="text-primary hover:text-primary-dark font-medium">Faça login</button>';
            } else {
                // Mudar para modo login
                loginForm.setAttribute('data-mode', 'login');
                loginTitle.textContent = 'Sistema de Checklist';
                loginButton.textContent = 'Entrar';
                toggleText.innerHTML = 'Não tem uma conta? <button onclick="toggleAuthMode()" class="text-primary hover:text-primary-dark font-medium">Cadastre-se</button>';
            }
        }

        // Processar formulário de autenticação
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const isSignUp = this.getAttribute('data-mode') === 'signup';
            
            showLoading(true);
            
            try {
                if (!window.supabase || !supabase) {
                    throw new Error('Cliente Supabase não inicializado. Verifique a URL e a chave.');
                }
                let result;
                
                if (isSignUp) {
                    result = await supabase.auth.signUp({
                        email,
                        password,
                    });
                } else {
                    result = await supabase.auth.signInWithPassword({
                        email,
                        password,
                    });
                }
                
                const { data, error } = result;
                
                if (error) {
                    throw error;
                }
                
                if (isSignUp && data.user && !data.session) {
                    showFloatingNotification('success', 'Conta criada com sucesso! Verifique seu email para confirmar.');
                    toggleAuthMode(); // Voltar para tela de login
                } else {
                    currentUser = data.user;
                    setCachedUser(data.user);
                    showApp();
                    showFloatingNotification('success', `Bem-vindo, ${data.user.email.split('@')[0]}!`);
                }
            } catch (error) {
                console.error('Erro de autenticação:', error);
                showCustomAlert(error.message || 'Falha na autenticação.');
                showFloatingNotification('error', error.message);
            } finally {
                showLoading(false);
            }
        });

        const loginSubmitBtn = document.getElementById('loginSubmit');
        if (loginSubmitBtn) {
            loginSubmitBtn.addEventListener('click', function(e) {
                e.preventDefault();
                const form = document.getElementById('loginForm');
                if (form) { form.requestSubmit(); }
            });
        }

        // Logout
        async function logout() {
            showLoading(true);
            
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    throw error;
                }
                
                currentUser = null;
                inspections = [];
                clearCachedUser();
                if (realtimeChannel) { try { supabase.removeChannel(realtimeChannel); } catch (_) {} realtimeChannel = null; }
                if (pollingTimer) { clearInterval(pollingTimer); pollingTimer = null; }
                showLogin();
                showFloatingNotification('success', 'Logout realizado com sucesso!');
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
                showFloatingNotification('error', 'Erro ao fazer logout');
            } finally {
                showLoading(false);
            }
        }

        // Carregar dados iniciais
        async function loadInitialData() {
            showLoading(true);
            
            try {
                let data = [];
                if (isOnline()) {
                    const resp = await supabase
                        .from('inspections')
                        .select('*')
                        .order('created_at', { ascending: false });
                    if (resp.error) { throw resp.error; }
                    data = dedupeInspections(resp.data || []);
                    setCachedInspections(data);
                } else {
                    data = dedupeInspections(getCachedInspections());
                    showFloatingNotification('warning', 'Sem internet. Exibindo dados em cache.');
                }
                inspections = data || [];
                notifications = getCachedNotifications();
                updateNotificationBadge();
                await loadEquipments();
                await seedTrucks();
                await seedHarvesters();
                await seedTractors();
                await seedPlanters();
                await seedDistributors();
                await seedTrailers();
                await syncPendingInspections();
                await syncPendingEquipments();
                updateStats();
                updateAnalytics();
                setTimeout(initializeCharts, 500);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showFloatingNotification('error', 'Erro ao carregar dados');
            } finally {
                showLoading(false);
            }
        }

        // Salvar inspeção no Supabase
        async function saveInspection() {
            if (savingInspection) return;
            // Validação do formulário
            const data = document.getElementById('dataInspecao').value;
            const frotaSel = document.getElementById('frotaSelect');
            const frotaCustom = document.getElementById('frotaCustom');
            const frota = frotaSel && frotaSel.value === 'custom' ? (frotaCustom.value || '').trim() : (frotaSel ? frotaSel.value.trim() : (document.getElementById('frota')?.value || '').trim());
            const mecanico = document.getElementById('mecanico').value.trim();
            const observacao = (document.getElementById('observacao')?.value || '').trim();
            
            if (!data || !frota || !mecanico) {
                showCustomAlert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            const completedItems = currentInspection.items.filter(item => item.status !== null);
            if (completedItems.length === 0) {
                showCustomAlert('Por favor, marque pelo menos um item do checklist.');
                return;
            }
            
            showLoading(true);
            savingInspection = true;
            const saveBtns = Array.from(document.querySelectorAll('button[onclick="saveInspection()"]'));
            saveBtns.forEach(b => { b.disabled = true; });

            const user = (typeof currentUser !== 'undefined' && currentUser) || getCachedUser() || getOfflineUser();
            const isAuthenticated = !!(user && user.id && user.id !== 'offline');
            const localId = (crypto && crypto.randomUUID ? crypto.randomUUID() : Date.now().toString());
            const inspection = {
                data: data,
                tipo: currentEquipment,
                frota: frota,
                mecanico: mecanico,
                observacao: observacao,
                items: currentInspection.items,
                results: currentInspection.results,
                user_id: user.id,
                created_at: new Date().toISOString(),
                local_id: localId
            };
            if (observacao) {
                const idx = inspection.items.length;
                inspection.items.push({ id: idx, name: 'Observação', status: null, note: observacao });
            }
            const dbInspection = { data: inspection.data, tipo: inspection.tipo, frota: inspection.frota, mecanico: inspection.mecanico, items: inspection.items, results: inspection.results, user_id: inspection.user_id, created_at: inspection.created_at, local_id: inspection.local_id };

            try {
                if (isOnline() && isAuthenticated) {
                    const { error } = await supabase
                        .from('inspections')
                        .upsert([dbInspection], { onConflict: 'local_id' });
                    if (error) {
                        const offlineItem = { ...inspection, offline: true };
                        offlineItem.id = offlineItem.local_id;
                        addOrReplaceInspection(offlineItem);
                        queueInspection(offlineItem);
                        
                        updateStats();
                        updateAnalytics();
                        showFloatingNotification('warning', `Erro ao salvar online: ${error.message}. Salvo offline e será sincronizado.`);
                        clearForm();
                        return;
                    }
                    await loadInitialData();
                    showModal('successModal');
                    clearForm();
                    showFloatingNotification('success', 'Inspeção salva com sucesso!');
                } else {
                    const offlineItem = { ...inspection, offline: true };
                    offlineItem.id = offlineItem.local_id;
                    addOrReplaceInspection(offlineItem);
                    queueInspection(offlineItem);
                    
                    updateStats();
                    updateAnalytics();
                    clearForm();
                    const msg = !isOnline() ? 'Sem internet. Inspeção salva offline e será sincronizada.' : 'Usuário não autenticado. Inspeção salva offline e será sincronizada.';
                    showFloatingNotification('warning', msg);
                }
            } catch (error) {
                const offlineItem2 = { ...inspection, offline: true };
                offlineItem2.id = offlineItem2.local_id;
                addOrReplaceInspection(offlineItem2);
                queueInspection(offlineItem2);
                updateStats();
                updateAnalytics();
                showFloatingNotification('warning', 'Falha ao salvar online. Inspeção salva offline e será sincronizada.');
                clearForm();
            } finally {
                showLoading(false);
                savingInspection = false;
                saveBtns.forEach(b => { b.disabled = false; });
            }
        }

        // Exportar dados
        async function exportData() {
            showLoading(true);
            
            try {
                let data = [];
                if (isOnline()) {
                    const resp = await supabase
                        .from('inspections')
                        .select('*')
                        .order('created_at', { ascending: false });
                    if (resp.error) { throw resp.error; }
                    data = resp.data || [];
                } else {
                    data = inspections.slice();
                }
                const exportData = {
                    inspections: data || [],
                    stats: {
                        total: data.length,
                        today: data.filter(i => i.data === new Date().toISOString().split('T')[0]).length,
                        average: data.length > 0 ? 
                            data.reduce((sum, i) => sum + i.results.percentage, 0) / data.length : 0
                    },
                    exportDate: new Date().toISOString(),
                    exportedBy: currentUser.email
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `checklist-export-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                showFloatingNotification('success', 'Dados exportados com sucesso!');
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                showFloatingNotification('error', 'Erro ao exportar dados');
            } finally {
                showLoading(false);
            }
        }

        // Mostrar/ocultar loading
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        async function loadEquipments() {
            try {
                if (isOnline()) {
                    const resp = await supabase
                        .from('equipments')
                        .select('*')
                        .order('created_at', { ascending: false });
                    if (!resp.error) {
                        equipments = resp.data || [];
                        setCachedEquipments(equipments);
                        return;
                    }
                }
                equipments = getCachedEquipments();
            } catch (_) {
                equipments = getCachedEquipments();
            }
        }

        function typeAliases(t) {
            const map = {
                caminhao: ['caminhao','truck'],
                trator: ['trator','tractor'],
                colhedora: ['colhedora','harvester'],
                reboque: ['reboque','trailer'],
                plantadora: ['plantadora','planter'],
                distribuidora: ['distribuidora','distributor'],
                manutencao: ['manutencao','maintenance']
            };
            return map[t] || [t];
        }

        function populateFrotaOptions(type) {
            const sel = document.getElementById('frotaSelect');
            if (!sel) return;
            const aliases = typeAliases(type);
            const list = (equipments || []).filter(e => aliases.includes(e.tipo || e.setor) && (e.status || 'ativo') === 'ativo');
            const opts = ['<option value="">Selecione uma frota</option>', '<option value="custom">Outro (digitar)</option>']
                .concat(list.map(e => `<option value="${e.frota}">${e.frota}${e.descricao ? ' - ' + e.descricao : ''}</option>`));
            sel.innerHTML = opts.join('');
            const custom = document.getElementById('frotaCustom');
            if (custom) custom.classList.add('hidden');
        }

        function bindFrotaSelect() {
            const sel = document.getElementById('frotaSelect');
            const custom = document.getElementById('frotaCustom');
            if (!sel || sel._bound) return;
            sel.addEventListener('change', () => {
                if (custom) {
                    if (sel.value === 'custom') custom.classList.remove('hidden'); else custom.classList.add('hidden');
                }
            });
            sel._bound = true;
        }

        async function addEquipment() {
            const tipo = document.getElementById('equipTipo').value;
            const frota = document.getElementById('equipFrota').value.trim();
            const descricao = document.getElementById('equipDesc').value.trim();
            const status = document.getElementById('equipStatus').value;
            if (!tipo || !frota) {
                showCustomAlert('Informe setor e frota.');
                return;
            }
            const item = { tipo, frota, descricao, status, created_at: new Date().toISOString() };
            showLoading(true);
            try {
                if (isOnline()) {
                    const { data, error } = await supabase
                        .from('equipments')
                        .insert([item])
                        .select();
                    if (error) throw error;
                    equipments.unshift(data && data[0] ? data[0] : item);
                } else {
                    equipments.unshift(item);
                    queueEquipment(item);
                }
                setCachedEquipments(equipments);
                populateEquipmentList();
                showFloatingNotification('success', 'Equipamento cadastrado');
                document.getElementById('equipFrota').value = '';
                document.getElementById('equipDesc').value = '';
            } catch (e) {
                equipments.unshift(item);
                setCachedEquipments(equipments);
                queueEquipment(item);
                populateEquipmentList();
                showFloatingNotification('warning', 'Falha ao cadastrar online. Salvo localmente.');
                document.getElementById('equipFrota').value = '';
                document.getElementById('equipDesc').value = '';
            } finally {
                showLoading(false);
            }
        }

        function populateEquipmentList() {
            const container = document.getElementById('equipList');
            const filterSel = document.getElementById('equipFilterTipo');
            if (!container) return;
            const tipo = filterSel ? filterSel.value : 'all';
            const aliases = tipo === 'all' ? null : typeAliases(tipo);
            const list = (equipments || []).filter(e => !aliases ? true : aliases.includes(e.tipo || e.setor));
            if (list.length === 0) {
                container.innerHTML = '<div class="text-gray-500 dark:text-gray-400">Nenhuma frota cadastrada</div>';
                return;
            }
            container.innerHTML = list.map(e => `
                <div class="p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${e.frota}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${(e.tipo||e.setor)}${e.descricao ? ' • ' + e.descricao : ''}</p>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full ${ (e.status||'ativo')==='ativo' ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200' : 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300' }">${e.status||'ativo'}</span>
                    </div>
                </div>
            `).join('');
            if (filterSel && !filterSel._bound) {
                filterSel.addEventListener('change', populateEquipmentList);
                filterSel._bound = true;
            }
        }

        // Funções auxiliares
        function updateDateTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit', 
                minute: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('pt-BR', options);
        }

        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('dataInspecao');
            if (dateInput) {
                dateInput.value = today;
            }
        }

        function showSection(sectionId) {
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active', 'border-primary', 'text-primary');
                btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'dark:text-gray-400', 'dark:hover:text-gray-300');
            });
            const selector = `button[onclick="showSection('${sectionId}')"]`;
            const activeBtn = document.querySelector(selector);
            if (activeBtn) {
                activeBtn.classList.add('active', 'border-primary', 'text-primary');
                activeBtn.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'dark:text-gray-400', 'dark:hover:text-gray-300');
            }
            
            // Show/hide sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('fade-in');
            }

            // Reset nova inspeção section
            if (sectionId === 'nova-inspecao') {
                backToSelection();
            }
            if (sectionId === 'analytics') {
                const sel = document.getElementById('chartPeriod');
                const days = sel ? parseInt(sel.value, 10) : 30;
                initializeCharts();
                updateAnalytics();
                updateAnalyticsSummary(days);
            }
            if (sectionId === 'equipamentos') {
                populateEquipmentList();
            }
        }

        function selectEquipment(type) {
            currentEquipment = type;
            document.getElementById('equipmentSelection').classList.add('hidden');
            document.getElementById('checklistForm').classList.remove('hidden');
            document.getElementById('checklistForm').classList.add('fade-in');
                const titles = {
                    caminhao: 'Checklist - Caminhão',
                    trator: 'Checklist - Trator',
                    colhedora: 'Checklist - Colhedora',
                    reboque: 'Checklist - Reboque',
                    manutencao: 'Checklist - Manutenção',
                    plantadora: 'Checklist - Plantadora de Cana',
                    distribuidora: 'Checklist - Distribuidora de Cana'
                };
            document.getElementById('checklistTitle').textContent = titles[type] || 'Checklist';
            generateChecklistItems(type);
            populateFrotaOptions(type);
            bindFrotaSelect();
            setCurrentDate();
            clearResults();
            toggleMobileBar(true);
        }

        function generateChecklistItems(type) {
            const container = document.getElementById('checklistItems');
            const map = { caminhao: 'truck', trator: 'tractor', colhedora: 'harvester', reboque: 'trailer', manutencao: 'maintenance', plantadora: 'planter', distribuidora: 'distributor' };
            const key = map[type];
            const config = key ? equipmentConfigs[key] : null;
            container.innerHTML = '';
            currentInspection.items = [];
            let index = 0;
            if (config && Array.isArray(config.sections)) {
                config.sections.forEach(section => {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'mb-6';
                    sectionDiv.innerHTML = `
                        <div class="px-4 py-2 bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-md">
                            <h5 class="text-sm font-semibold text-green-800 dark:text-green-200">${section.name}</h5>
                        </div>
                    `;
                    container.appendChild(sectionDiv);
                if (Array.isArray(section.items)) {
                    section.items.forEach(item => {
                        const itemData = { id: index, name: item, section: section.name, status: null, note: '' };
                        currentInspection.items.push(itemData);
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'p-4 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg';
                        itemDiv.innerHTML = `
                            <div class="flex items-center justify-between">
                                <span class="text-gray-900 dark:text-white">${item}</span>
                                <div class="flex space-x-3">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="item_${index}" value="ok" onchange="updateItemStatus(${index}, 'ok')" class="form-radio h-6 w-6 sm:h-4 sm:w-4 text-primary">
                                        <span class="ml-2 text-sm text-green-600 dark:text-green-400">OK</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="item_${index}" value="notok" onchange="updateItemStatus(${index}, 'notok')" class="form-radio h-6 w-6 sm:h-4 sm:w-4 text-primary">
                                        <span class="ml-2 text-sm text-red-600 dark:text-red-400">NÃO OK</span>
                                    </label>
                                </div>
                            </div>
                            <div class="mt-3 hidden" id="note_${index}">
                                <textarea rows="2" placeholder="Observação deste item (opcional)" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" oninput="updateItemNote(${index}, this.value)"></textarea>
                            </div>
                        `;
                        container.appendChild(itemDiv);
                        index++;
                    });
                }
                // Observações da seção (nota sem status)
                const secIndex = index;
                currentInspection.items.push({ id: secIndex, name: `Observações da seção - ${section.name}`, section: section.name, status: null, note: '' });
                const secNoteDiv = document.createElement('div');
                secNoteDiv.className = 'p-4 bg-gray-50 dark:bg-gray-800 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg';
                secNoteDiv.innerHTML = `
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações da seção</label>
                    <textarea rows="2" placeholder="Observações gerais desta seção" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" oninput="updateItemNote(${secIndex}, this.value)"></textarea>
                `;
                container.appendChild(secNoteDiv);
                index++;
            });
        }
        }

        function updateItemStatus(itemId, status) {
            currentInspection.items[itemId].status = status;
            const noteBox = document.getElementById(`note_${itemId}`);
            if (noteBox) {
                if (status === 'notok') noteBox.classList.remove('hidden'); else { noteBox.classList.add('hidden'); updateItemNote(itemId, ''); }
            }
            calculateResults();
        }

        function updateItemNote(itemId, value) {
            currentInspection.items[itemId].note = value || '';
        }

        function calculateResults() {
            let ok = 0, notOk = 0;
            
            currentInspection.items.forEach(item => {
                if (item.status === 'ok') ok++;
                else if (item.status === 'notok') notOk++;
            });
            
            const total = ok + notOk;
            const percentage = total > 0 ? Math.round((ok / total) * 100) : 0;
            
            currentInspection.results = { ok, notOk, percentage };
            
            // Update UI
            document.getElementById('itensOK').textContent = ok;
            document.getElementById('itensNaoOK').textContent = notOk;
            document.getElementById('percentual').textContent = percentage + '%';
            
            // Update maintenance level
            let nivel = '';
            if (percentage >= 90) nivel = 'Excelente';
            else if (percentage >= 80) nivel = 'Bom';
            else if (percentage >= 70) nivel = 'Regular';
            else if (percentage > 0) nivel = 'Crítico';
            else nivel = '-';
            
            document.getElementById('nivelManutencao').textContent = `Nível de Manutenção: ${nivel}`;
        }

        function clearResults() {
            currentInspection.results = { ok: 0, notOk: 0, percentage: 0 };
            document.getElementById('itensOK').textContent = '0';
            document.getElementById('itensNaoOK').textContent = '0';
            document.getElementById('percentual').textContent = '0%';
            document.getElementById('nivelManutencao').textContent = 'Nível de Manutenção: -';
        }

        function clearForm() {
            // Clear form inputs
            document.getElementById('frota').value = '';
            document.getElementById('mecanico').value = '';
            if (document.getElementById('observacao')) document.getElementById('observacao').value = '';
            setCurrentDate();
            
            // Clear checklist selections
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            
            // Reset current inspection data
            currentInspection.items.forEach(item => {
                item.status = null;
                item.note = '';
            });
            
            clearResults();
        }

        function backToSelection() {
            document.getElementById('checklistForm').classList.add('hidden');
            document.getElementById('equipmentSelection').classList.remove('hidden');
            currentEquipment = '';
            clearForm();
            toggleMobileBar(false);
        }

        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayInspections = inspections.filter(inspection => 
                inspection.data === today
            );
            
            // Count by equipment type
            const counts = {
                caminhao: inspections.filter(i => i.tipo === 'caminhao').length,
                trator: inspections.filter(i => i.tipo === 'trator').length,
                colhedora: inspections.filter(i => i.tipo === 'colhedora').length,
                plantadora: inspections.filter(i => i.tipo === 'plantadora').length,
                distribuidora: inspections.filter(i => i.tipo === 'distribuidora').length,
                reboque: inspections.filter(i => i.tipo === 'reboque').length,
                manutencao: inspections.filter(i => i.tipo === 'manutencao').length
            };
            
            const totalEquipments = Object.values(counts).reduce((a, b) => a + b, 0);
            const avgLevel = inspections.length > 0 ? 
                Math.round(inspections.reduce((sum, i) => sum + i.results.percentage, 0) / inspections.length) : 0;
            const todayOk = todayInspections.reduce((s, i) => s + (i.results?.ok || 0), 0);
            const todayNotOk = todayInspections.reduce((s, i) => s + (i.results?.notOk || 0), 0);
            const todayTotal = todayOk + todayNotOk;
            const taxaHoje = todayTotal > 0 ? Math.round((todayOk / todayTotal) * 100) : 0;
            
            // Update dashboard
            document.getElementById('totalInspecoes').textContent = inspections.length;
            document.getElementById('inspecoesHoje').textContent = todayInspections.length;
            document.getElementById('equipamentosAtivos').textContent = totalEquipments;
            document.getElementById('nivelMedio').textContent = avgLevel + '%';
            const tj = document.getElementById('taxaHoje');
            if (tj) { tj.textContent = taxaHoje + '%'; }
            const prod = document.getElementById('productivity');
            if (prod) { prod.textContent = avgLevel + '%'; }
            updateRing('nivelMedioCircle', avgLevel);
            updateRing('taxaHojeCircle', taxaHoje);
            updateSparkline();
            
            // Update equipment counts
            document.getElementById('countCaminhoes').textContent = counts.caminhao;
            document.getElementById('countTratores').textContent = counts.trator;
            document.getElementById('countColhedoras').textContent = counts.colhedora;
            document.getElementById('countReboques').textContent = counts.reboque;
            
            // Update recent inspections
            updateRecentInspections();
            
            // Update history table
            updateHistoryTable();
            populateAnalyticsFilters();
        }

        function updateRing(id, percentage) {
            const circle = document.getElementById(id);
            if (!circle) return;
            const r = circle.r.baseVal.value;
            const c = r * 2 * Math.PI;
            const off = c - (percentage / 100) * c;
            circle.style.strokeDasharray = `${c} ${c}`;
            circle.style.strokeDashoffset = off;
            if (percentage >= 80) circle.style.stroke = '#10B981';
            else if (percentage >= 60) circle.style.stroke = '#F59E0B';
            else circle.style.stroke = '#EF4444';
        }

        function updateRecentInspections() {
            const container = document.getElementById('inspecoesRecentes');
            const recent = inspections.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        <svg class="mx-auto h-12 w-12 text-gray-300 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p class="mt-2">Nenhuma inspeção realizada ainda</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(inspection => {
                const statusColor = inspection.results.percentage >= 80 ? 'green' : 
                                  inspection.results.percentage >= 60 ? 'yellow' : 'red';
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">${inspection.frota}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${inspection.tipo.charAt(0).toUpperCase() + inspection.tipo.slice(1)} - ${new Date(inspection.data).toLocaleDateString('pt-BR')}</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusColor}-100 text-${statusColor}-800 dark:bg-${statusColor}-900 dark:text-${statusColor}-200">
                                ${inspection.results.percentage}%
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateHistoryTable(list = inspections) {
            const tbody = document.getElementById('historyTableBody');
            if (!list || list.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                            <svg class="mx-auto h-12 w-12 text-gray-300 dark:text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            Nenhuma inspeção encontrada
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = list.slice().reverse().map(inspection => {
                const statusColor = inspection.results.percentage >= 80 ? 'green' : 
                                  inspection.results.percentage >= 60 ? 'yellow' : 'red';
                const statusText = inspection.results.percentage >= 80 ? 'Aprovado' : 
                                 inspection.results.percentage >= 60 ? 'Atenção' : 'Reprovado';
                const inspId = (inspection.id ?? inspection.local_id ?? '').toString();
                const isPending = !!inspection.offline || (!inspection.id && !!inspection.local_id);
                const stateBadge = isPending
                    ? `<span class=\"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 ml-2\">Pendente</span>`
                    : `<span class=\"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 ml-2\">Sincronizado</span>`;
                
                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                        <td class="px-6 py-4 text-sm text-gray-900 dark:text-white">${new Date(inspection.data).toLocaleDateString('pt-BR')}</td>
                        <td class="px-6 py-4 text-sm text-gray-900 dark:text-white">${inspection.tipo.charAt(0).toUpperCase() + inspection.tipo.slice(1)}</td>
                        <td class="px-6 py-4 text-sm text-gray-900 dark:text-white">${inspection.frota}</td>
                        <td class="px-6 py-4 text-sm text-gray-900 dark:text-white">${inspection.mecanico}</td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusColor}-100 text-${statusColor}-800 dark:bg-${statusColor}-900 dark:text-${statusColor}-200">
                                ${statusText}
                            </span>
                            ${stateBadge}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900 dark:text-white">${inspection.results.percentage}%</td>
                        <td class="px-6 py-4">
                            <button onclick="viewInspection('${inspId}')" class="text-primary hover:text-primary-dark text-sm font-medium">
                                Ver detalhes
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function toggleMobileBar(show) {
            const bar = document.getElementById('mobileActionBar');
            if (!bar) return;
            if (show) bar.classList.remove('hidden'); else bar.classList.add('hidden');
        }

        function filterHistory() {
            const tipo = document.getElementById('filtroTipo').value;
            const di = document.getElementById('filtroDataInicial').value;
            const df = document.getElementById('filtroDataFinal').value;
            const diTime = di ? new Date(di).getTime() : null;
            const dfTime = df ? new Date(df).getTime() : null;
            const filtered = inspections.filter(i => {
                const matchesTipo = !tipo || i.tipo === tipo;
                const t = new Date(i.data).getTime();
                const afterStart = diTime == null || t >= diTime;
                const beforeEnd = dfTime == null || t <= dfTime;
                return matchesTipo && afterStart && beforeEnd;
            });
            updateHistoryTable(filtered);
        }

        function debounce(fn, delay) {
            let timer;
            return function(...args) {
                clearTimeout(timer);
                timer = setTimeout(() => fn.apply(this, args), delay);
            }
        }

        function viewInspection(id) {
            const matchId = String(id);
            const inspection = inspections.find(i => String(i.id) === matchId) || inspections.find(i => String(i.local_id) === matchId);
            if (!inspection) return;
            currentInspectionId = matchId;
            const details = document.getElementById('inspectionDetails');
            const header = `
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Data</p>
                        <p class="font-medium text-gray-900 dark:text-white">${new Date(inspection.data).toLocaleDateString('pt-BR')}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Equipamento</p>
                        <p class="font-medium text-gray-900 dark:text-white">${inspection.tipo}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Frota</p>
                        <p class="font-medium text-gray-900 dark:text-white">${inspection.frota}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Líder</p>
                        <p class="font-medium text-gray-900 dark:text-white">${inspection.mecanico}</p>
                    </div>
                </div>
            `;
            let itemsHtml = `<div class="text-center text-gray-500 dark:text-gray-400 py-6">Sem itens registrados</div>`;
            if (Array.isArray(inspection.items) && inspection.items.length > 0) {
                const groups = {};
                const sectionNotes = {};
                inspection.items.forEach(it => {
                    if (String(it.name).startsWith('Observações da seção - ')) {
                        const sec = String(it.name).replace('Observações da seção - ', '');
                        sectionNotes[sec] = it.note || '';
                    } else {
                        const sec = it.section || 'Geral';
                        if (!groups[sec]) groups[sec] = [];
                        groups[sec].push(it);
                    }
                });
                const sections = Object.keys(groups);
                itemsHtml = sections.map(sec => {
                    const rows = groups[sec].map((it, idx) => {
                        const ok = it.status === 'ok';
                        const color = ok ? 'green' : 'red';
                        const label = ok ? 'OK' : 'NÃO OK';
                        const statusHtml = `<span class=\"px-2 py-1 rounded text-xs font-medium bg-${color}-100 text-${color}-800 dark:bg-${color}-900 dark:text-${color}-200\">${label}</span>`;
                        const noteHtml = it.note ? `<div class=\"mt-1 text-xs text-gray-600 dark:text-gray-300\">Obs: ${it.note}</div>` : '';
                        return `
                            <div class=\"p-3 bg-gray-50 dark:bg-gray-700 rounded-md\">
                                <div class=\"flex items-center justify-between\">
                                    <span class=\"text-gray-900 dark:text-white\">${it.name}</span>
                                    ${statusHtml}
                                </div>
                                ${noteHtml}
                            </div>
                        `;
                    }).join('');
                    const secNote = sectionNotes[sec] ? `<div class=\"mt-2 text-xs text-gray-700 dark:text-gray-200\"><span class=\"font-medium\">Observações da seção:</span> ${sectionNotes[sec]}</div>` : '';
                    return `
                        <div class=\"mb-4\">
                            <div class=\"px-4 py-2 bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-md mb-2\">
                                <h5 class=\"text-sm font-semibold text-green-800 dark:text-green-200\">${sec}</h5>
                            </div>
                            <div class=\"space-y-2\">${rows}</div>
                            ${secNote}
                        </div>
                    `;
                }).join('');
            }
            const obsBlock = inspection.observacao ? `
                <div class="mt-4">
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Observação</p>
                    <p class="text-sm text-gray-900 dark:text-white">${inspection.observacao}</p>
                </div>
            ` : '';
            const summary = `
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-500 dark:text-gray-400">Resultado</div>
                    <div class="text-sm text-gray-900 dark:text-white">${inspection.results.ok} OK, ${inspection.results.notOk} NÃO OK (${inspection.results.percentage}%)</div>
                </div>
            `;
            details.innerHTML = header + `<div class="space-y-2">${itemsHtml}</div>` + obsBlock + summary;
            const btn = document.getElementById('printInspectionBtn');
            if (btn) { btn.disabled = false; }
            showModal('inspectionModal');
        }

        function printInspection(id) {
            const matchId = String(id);
            const inspection = inspections.find(i => String(i.id) === matchId || String(i.local_id) === matchId);
            if (!inspection) { showCustomAlert('Inspeção não encontrada'); return; }
            const sectionNotes = {};
            const normalItems = Array.isArray(inspection.items) ? inspection.items.filter(it => {
                if (String(it.name).startsWith('Observações da seção - ')) {
                    const sec = String(it.name).replace('Observações da seção - ', '');
                    sectionNotes[sec] = it.note || '';
                    return false;
                }
                return true;
            }) : [];
            const rows = normalItems.map((it, idx) => `
                <tr>
                    <td>${idx+1}</td>
                    <td>${it.section || ''}</td>
                    <td>${it.name}</td>
                    <td>${it.status === 'ok' ? 'OK' : (it.status === 'notok' ? 'NÃO OK' : '')}</td>
                    <td>${it.note || ''}</td>
                </tr>
            `).join('');
            const doc = `
                <html><head>
                    <meta name="viewport" content="width=device-width, initial-scale=1" />
                    <meta charset="utf-8" />
                    <title>Checklist</title>
                    <style>
                        @page { size: A4 portrait; margin: 12mm; }
                        * { box-sizing: border-box; }
                        body { font-family: Inter, Arial, sans-serif; padding: 0; color: #111827; }
                        .container { max-width: 940px; margin: 0 auto; padding: 24px; }
                        .header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 16px; }
                        .brand { display:flex; align-items:center; gap:10px; }
                        .logo { width:28px; height:28px; border-radius:8px; background:#5D5CDE; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; }
                        .title { font-size: 18px; font-weight: 700; }
                        .subtitle { font-size: 12px; color:#6B7280; }
                        .info { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px; margin: 12px 0; }
                        .info .i { border:1px solid #e5e7eb; border-radius:8px; padding:8px; }
                        .info .i h5 { margin:0; font-size:11px; color:#6B7280; }
                        .info .i p { margin:4px 0 0; font-size:13px; font-weight:600; }
                        .badges { display:flex; gap:8px; margin: 8px 0 12px; }
                        .badge { display:inline-block; border-radius:6px; padding:4px 8px; font-size:11px; border:1px solid #e5e7eb; }
                        .ok { background:#ECFDF5; color:#065F46; border-color:#D1FAE5; }
                        .nok { background:#FEF2F2; color:#7F1D1D; border-color:#FECACA; }
                        .table-wrap { margin-top: 8px; }
                        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
                        thead th { background: #f3f4f6; text-align: left; font-size: 11px; color:#374151; border-bottom:1px solid #e5e7eb; }
                        th, td { border: 1px solid #e5e7eb; padding: 8px 10px; font-size: 11px; word-break: break-word; }
                        tbody tr:nth-child(odd) { background: #fafafa; }
                        .sections { margin-top: 14px; }
                        .sec { margin-top: 10px; }
                        .sec h4 { font-size: 12px; margin: 0 0 6px; color:#374151; }
                        .footer { margin-top: 18px; font-size: 11px; color:#6B7280; text-align:right; }
                        @media screen { body { background:#f3f4f6; } .container { background:#fff; padding:24px; box-shadow: 0 1px 6px rgba(0,0,0,0.08); } }
                    </style>
                </head><body onload="window.print()">
                    <div class="container">
                        <div class="header">
                            <div class="brand"><div class="logo">C</div><div><div class="title">Checklist</div><div class="subtitle">${new Date(inspection.data).toLocaleDateString('pt-BR')}</div></div></div>
                            <div class="subtitle">Gerado em ${new Date().toLocaleString('pt-BR')}</div>
                        </div>
                        <div class="info">
                            <div class="i"><h5>Equipamento</h5><p>${inspection.tipo}</p></div>
                            <div class="i"><h5>Frota</h5><p>${inspection.frota}</p></div>
                            <div class="i"><h5>Líder</h5><p>${inspection.mecanico}</p></div>
                            <div class="i"><h5>Percentual</h5><p>${inspection.results.percentage}%</p></div>
                        </div>
                        <div class="badges">
                            <span class="badge ok">${inspection.results.ok} OK</span>
                            <span class="badge nok">${inspection.results.notOk} NÃO OK</span>
                        </div>
                        ${inspection.observacao ? `<div style="font-size:12px;color:#374151;margin-bottom:8px;"><strong>Observação:</strong> ${inspection.observacao}</div>` : ''}
                        <div class="table-wrap">
                            <table>
                                <thead><tr><th>#</th><th>Seção</th><th>Item</th><th>Status</th><th>Observação</th></tr></thead>
                                <tbody>${rows}</tbody>
                            </table>
                        </div>
                        ${Object.keys(sectionNotes).length > 0 ? `
                        <div class="sections">
                            <h3 style="font-size:13px;margin:10px 0;">Observações por Seção</h3>
                            <table>
                                <thead><tr><th>Seção</th><th>Observações</th></tr></thead>
                                <tbody>
                                    ${Object.entries(sectionNotes).map(([sec, note]) => `<tr><td>${sec}</td><td>${note}</td></tr>`).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : ''}
                        <div class="footer">Sistema de Checklist • ${new Date().getFullYear()}</div>
                    </div>
                </body></html>
            `;
            const w = window.open('', '_blank');
            if (w) { w.document.write(doc); w.document.close(); }
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4 fade-in">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Atenção</h3>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 mb-4 whitespace-pre-line">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors duration-200">
                        OK
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Advanced Features
        
        // Search functionality
        document.getElementById('globalSearch').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            if (query.length < 2) return;
            
            const results = inspections.filter(inspection => 
                inspection.frota.toLowerCase().includes(query) ||
                inspection.mecanico.toLowerCase().includes(query) ||
                inspection.tipo.toLowerCase().includes(query)
            );
            
            showSearchResults(results);
        });

        function showSearchResults(results) {
            // Implementation for search results dropdown
            console.log('Search results:', results);
        }

        // Notification system
        let notifications = [];

        function showNotificationCenter() {
            const center = document.getElementById('notificationCenter');
            center.classList.toggle('hidden');
            
            if (!center.classList.contains('hidden')) {
                updateNotificationList();
                markAllNotificationsRead();
            }
        }

        function updateNotificationList() {
            const container = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="p-4 text-center text-gray-500 dark:text-gray-400">
                        <p>Nenhuma notificação</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = notifications.map(notif => {
                const iconColors = {
                    warning: 'text-yellow-500',
                    info: 'text-blue-500',
                    error: 'text-red-500',
                    success: 'text-green-500'
                };
                
                const bgColors = {
                    warning: 'bg-yellow-50 dark:bg-yellow-900/20',
                    info: 'bg-blue-50 dark:bg-blue-900/20',
                    error: 'bg-red-50 dark:bg-red-900/20',
                    success: 'bg-green-50 dark:bg-green-900/20'
                };
                
                return `
                    <div class="p-3 m-2 rounded-lg ${bgColors[notif.type]} border border-gray-200 dark:border-gray-600">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <svg class="w-5 h-5 ${iconColors[notif.type]}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.268 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 dark:text-white">${notif.title}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${notif.message}</p>
                                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">${formatNotificationTime(notif.created_at || new Date().toISOString())}</p>
                            </div>
                            <button onclick="removeNotification('${notif.id}')" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function clearAllNotifications() {
            notifications = [];
            setCachedNotifications([]);
            updateNotificationList();
            updateNotificationBadge();
        }

        function showFloatingNotification(type, message, duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notificationId = 'notif-' + Date.now();
            
            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = 'notification-slide bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 max-w-sm';
            
            const typeColors = {
                success: 'border-l-4 border-l-green-500',
                error: 'border-l-4 border-l-red-500',
                warning: 'border-l-4 border-l-yellow-500',
                info: 'border-l-4 border-l-blue-500'
            };
            
            notification.className += ' ' + typeColors[type];
            
            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-1">
                        <p class="text-sm text-gray-900 dark:text-white">${message}</p>
                    </div>
                    <button onclick="document.getElementById('${notificationId}').remove()" class="ml-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (document.getElementById(notificationId)) {
                    notification.remove();
                }
            }, duration);
        }

        function pushNotification(type, title, message) {
            const item = { id: Date.now().toString(), type, title, message, created_at: new Date().toISOString(), read: false };
            notifications.unshift(item);
            setCachedNotifications(notifications);
            updateNotificationBadge();
            const center = document.getElementById('notificationCenter');
            if (center && !center.classList.contains('hidden')) updateNotificationList();
        }

        function markAllNotificationsRead() {
            notifications = notifications.map(n => ({ ...n, read: true }));
            setCachedNotifications(notifications);
            updateNotificationBadge();
        }

        function removeNotification(id) {
            notifications = notifications.filter(n => n.id !== id);
            setCachedNotifications(notifications);
            updateNotificationList();
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (!badge) return;
            const unread = notifications.filter(n => !n.read).length;
            if (unread > 0) {
                badge.textContent = String(unread);
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function formatNotificationTime(iso) {
            if (!iso) return '';
            const d = new Date(iso);
            const diff = Math.floor((Date.now() - d.getTime()) / 60000);
            if (diff < 1) return 'agora';
            if (diff < 60) return `${diff} min atrás`;
            const h = Math.floor(diff / 60);
            if (h < 24) return `${h} h atrás`;
            const days = Math.floor(h / 24);
            return `${days} d atrás`;
        }

        function mapTypeTitle(type) {
            if (type === 'success') return 'Sucesso';
            if (type === 'error') return 'Erro';
            if (type === 'warning') return 'Aviso';
            return 'Informação';
        }

        // Charts initialization
        let performanceChart = null;
        let equipmentChart = null;
        let sparklineChart = null;
        let chartLoaderPromise = null;

        function ensureChartJs() {
            if (typeof Chart !== 'undefined') return Promise.resolve();
            if (chartLoaderPromise) return chartLoaderPromise;
            chartLoaderPromise = new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js';
                s.onload = () => resolve();
                s.onerror = () => {
                    const s2 = document.createElement('script');
                    s2.src = 'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.min.js';
                    s2.onload = () => resolve();
                    s2.onerror = () => reject(new Error('chartjs-load-failed'));
                    document.head.appendChild(s2);
                };
                document.head.appendChild(s);
            });
            return chartLoaderPromise;
        }

        function initializeCharts() {
            ensureChartJs().then(() => {
            const sel = document.getElementById('chartPeriod');
            populateAnalyticsFilters();
            const days = sel ? parseInt(sel.value, 10) : 30;
            buildCharts(days);
            updateAnalyticsSummary(days);
            if (sel && !sel._bound) {
                sel.addEventListener('change', () => {
                    const d = parseInt(sel.value, 10);
                    buildCharts(d);
                    updateAnalyticsSummary(d);
                });
                sel._bound = true;
            }
            const eqSel = document.getElementById('equipmentFilter');
            const ldSel = document.getElementById('leaderFilter');
            const clearBtn = document.getElementById('clearAnalyticsFilters');
            [eqSel, ldSel].forEach(el => {
                if (el && !el._bound) {
                    el.addEventListener('change', () => {
                        const d = sel ? parseInt(sel.value, 10) : 30;
                        buildCharts(d);
                        updateAnalyticsSummary(d);
                        updateAnalytics();
                    });
                    el._bound = true;
                }
            });
            if (clearBtn && !clearBtn._bound) {
                clearBtn.addEventListener('click', () => {
                    if (eqSel) eqSel.value = 'all';
                    if (ldSel) ldSel.value = 'all';
                    const d = sel ? parseInt(sel.value, 10) : 30;
                    buildCharts(d);
                    updateAnalyticsSummary(d);
                    updateAnalytics();
                });
                clearBtn._bound = true;
            }
            }).catch(() => {
                showFloatingNotification('warning', 'Gráficos indisponíveis. Verifique sua conexão.');
            });
        }

        function buildCharts(days) {
            const end = new Date();
            const start = new Date();
            start.setDate(end.getDate() - days + 1);
            const eqSel = document.getElementById('equipmentFilter');
            const ldSel = document.getElementById('leaderFilter');
            const eqFilter = eqSel ? eqSel.value : 'all';
            const ldFilter = ldSel ? ldSel.value : 'all';
            const filtered = inspections.filter(i => {
                const d = new Date(i.data);
                const inRange = d >= start && d <= end;
                const byEq = eqFilter === 'all' ? true : i.tipo === eqFilter;
                const byLd = ldFilter === 'all' ? true : (i.mecanico || '') === ldFilter;
                return inRange && byEq && byLd;
            });
            const byDay = {};
            filtered.forEach(i => {
                const k = new Date(i.data).toISOString().split('T')[0];
                if (!byDay[k]) byDay[k] = [];
                byDay[k].push(i.results?.percentage || 0);
            });
            const labels = Object.keys(byDay).sort((a,b)=>new Date(a)-new Date(b)).map(d=>new Date(d).toLocaleDateString('pt-BR'));
            const data = Object.keys(byDay).sort((a,b)=>new Date(a)-new Date(b)).map(d=>{
                const arr = byDay[d];
                const avg = arr.length ? Math.round(arr.reduce((s,v)=>s+v,0)/arr.length) : 0;
                return avg;
            });
            const perfCtx = document.getElementById('performanceChart');
            if (perfCtx && typeof Chart !== 'undefined') {
                if (!performanceChart) {
                    performanceChart = new Chart(perfCtx, {
                        type: 'line',
                        data: { labels, datasets: [{ label: 'Taxa de Aprovação (%)', data, borderColor: '#5D5CDE', backgroundColor: 'rgba(93,92,222,0.1)', fill: true, tension: 0.4 }] },
                        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100 } }, plugins: { legend: { display: false } } }
                    });
                } else {
                    performanceChart.data.labels = labels;
                    performanceChart.data.datasets[0].data = data;
                    performanceChart.update();
                }
            }
            const equipCtx = document.getElementById('equipmentChart');
            if (equipCtx && typeof Chart !== 'undefined') {
                const mapLabels = { caminhao: 'Caminhões', trator: 'Tratores', colhedora: 'Colhedoras', reboque: 'Reboques', manutencao: 'Manutenção' };
                const order = ['caminhao','trator','colhedora','reboque','manutencao'];
                const counts = { caminhao: 0, trator: 0, colhedora: 0, reboque: 0, manutencao: 0 };
                filtered.forEach(i => { if (counts[i.tipo] !== undefined) counts[i.tipo]++; });
                const labelsEquip = order.map(k => mapLabels[k]);
                const dataEquip = order.map(k => counts[k]);
                const colors = ['#3B82F6','#10B981','#8B5CF6','#F59E0B','#EF4444'];
                if (!equipmentChart) {
                    equipmentChart = new Chart(equipCtx, {
                        type: 'doughnut',
                        data: { labels: labelsEquip, datasets: [{ data: dataEquip, backgroundColor: colors }] },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, onClick: (evt, elements) => {
                            const eqSel = document.getElementById('equipmentFilter');
                            if (!elements || elements.length === 0 || !eqSel) return;
                            const idx = elements[0].index;
                            const order = ['caminhao','trator','colhedora','reboque','manutencao'];
                            eqSel.value = order[idx] || 'all';
                            const d = document.getElementById('chartPeriod') ? parseInt(document.getElementById('chartPeriod').value, 10) : 30;
                            buildCharts(d);
                            updateAnalyticsSummary(d);
                            updateAnalytics();
                        } }
                    });
                } else {
                    equipmentChart.data.labels = labelsEquip;
                    equipmentChart.data.datasets[0].data = dataEquip;
                    equipmentChart.update();
                }
            }
        }

        function updateAnalyticsSummary(days) {
            const end = new Date();
            const start = new Date();
            start.setDate(end.getDate() - days + 1);
            const eqSel = document.getElementById('equipmentFilter');
            const ldSel = document.getElementById('leaderFilter');
            const eqFilter = eqSel ? eqSel.value : 'all';
            const ldFilter = ldSel ? ldSel.value : 'all';
            const filtered = inspections.filter(i => {
                const d = new Date(i.created_at || i.data);
                const inRange = d >= start && d <= end;
                const byEq = eqFilter === 'all' ? true : i.tipo === eqFilter;
                const byLd = ldFilter === 'all' ? true : (i.mecanico || '') === ldFilter;
                return inRange && byEq && byLd;
            });
            const approvalEl = document.getElementById('approvalRate');
            const avgTimeEl = document.getElementById('avgTime');
            const productivityEl = document.getElementById('productivity');
            if (filtered.length === 0) {
                if (approvalEl) approvalEl.textContent = '0%';
                if (avgTimeEl) avgTimeEl.textContent = '—';
                if (productivityEl) productivityEl.textContent = '0%';
                return;
            }
            const avgApproval = Math.round(filtered.reduce((s, i) => s + (i.results?.percentage || 0), 0) / filtered.length);
            if (approvalEl) approvalEl.textContent = `${avgApproval}%`;
            const times = filtered
                .map(i => new Date(i.created_at || i.data).getTime())
                .sort((a, b) => a - b);
            const intervals = [];
            for (let idx = 1; idx < times.length; idx++) {
                intervals.push(times[idx] - times[idx - 1]);
            }
            const avgMs = intervals.length > 0 ? Math.round(intervals.reduce((s, v) => s + v, 0) / intervals.length) : 0;
            let avgLabel = '—';
            if (avgMs > 0) {
                const mins = Math.round(avgMs / 60000);
                if (mins < 120) avgLabel = `${mins}min`;
                else {
                    const hours = Math.round(mins / 60);
                    if (hours < 48) avgLabel = `${hours}h`;
                    else avgLabel = `${Math.round(hours / 24)}d`;
                }
            }
            if (avgTimeEl) avgTimeEl.textContent = avgLabel;
            const totalDays = days;
            const daySet = new Set(times.map(t => new Date(t).toISOString().split('T')[0]));
            const productivity = Math.round((daySet.size / totalDays) * 100);
            if (productivityEl) productivityEl.textContent = `${productivity}%`;
        }

        function populateAnalyticsFilters() {
            const ldSel = document.getElementById('leaderFilter');
            if (!ldSel) return;
            const leaders = Array.from(new Set((inspections || []).map(i => i.mecanico).filter(Boolean))).sort();
            const current = ldSel.value;
            ldSel.innerHTML = '<option value="all" selected>Todos líderes</option>' + leaders.map(l => `<option value="${l}">${l}</option>`).join('');
            if (current && current !== 'all') {
                ldSel.value = current;
            }
        }

        function downloadChart(canvasId, name) {
            const c = document.getElementById(canvasId);
            if (!c) return;
            const url = c.toDataURL('image/png');
            const a = document.createElement('a');
            a.href = url;
            a.download = `${name}-analytics.png`;
            document.body.appendChild(a);
            a.click();
            a.remove();
        }

        function setupRealtime() {
            try {
                if (realtimeChannel) return;
                realtimeChannel = supabase.channel('all-changes')
                    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'inspections' }, (payload) => {
                        if (!savingInspection) {
                            loadInitialData();
                        }
                        const r = payload && payload.new ? payload.new : {};
                        const f = r.frota || '';
                        pushNotification('info', 'Nova inspeção', f ? `Inspeção lançada para ${f}` : 'Inspeção lançada');
                    })
                    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'equipments' }, (payload) => {
                        loadEquipments().then(() => {
                            populateEquipmentList();
                        });
                        const r = payload && payload.new ? payload.new : {};
                        const f = r.frota || '';
                        pushNotification('info', 'Novo equipamento', f ? `Equipamento ${f} cadastrado` : 'Equipamento cadastrado');
                    })
                    .subscribe();
            } catch (e) {
                console.warn('Realtime não disponível:', e);
            }
        }

        function startPolling() {
            if (pollingTimer) return;
            pollingTimer = setInterval(() => {
                loadInitialData();
            }, 15000);
        }

        async function syncPendingInspections() {
            if (syncingInspections) return;
            const queue = getPendingInspections();
            if (!isOnline() || queue.length === 0) return;
            syncingInspections = true;
            showFloatingNotification('info', 'Sincronizando dados offline...');
            setPendingInspections([]);
            const remaining = [];
            for (const item of queue) {
                try {
                    const { error } = await supabase
                        .from('inspections')
                        .upsert([{ data: item.data, tipo: item.tipo, frota: item.frota, mecanico: item.mecanico, items: item.items, results: item.results, user_id: item.user_id, created_at: item.created_at, local_id: item.local_id }], { onConflict: 'local_id' });
                    if (error) { throw error; }
                } catch (e) {
                    remaining.push(item);
                }
            }
            setPendingInspections(remaining);
            await loadInitialData();
            if (remaining.length === 0) showFloatingNotification('success', 'Sincronização concluída'); else showFloatingNotification('warning', 'Alguns itens não sincronizaram');
            syncingInspections = false;
        }

        async function syncPendingEquipments() {
            const queue = getPendingEquipments();
            if (!isOnline() || queue.length === 0) return;
            const remaining = [];
            for (const item of queue) {
                try {
                    const { error } = await supabase
                        .from('equipments')
                        .insert([{ tipo: item.tipo, frota: item.frota, descricao: item.descricao, status: item.status, created_at: item.created_at }]);
                    if (error) throw error;
                } catch (e) {
                    remaining.push(item);
                }
            }
            setPendingEquipments(remaining);
            await loadEquipments();
            populateEquipmentList();
            if (remaining.length === 0) showFloatingNotification('success', 'Frotas sincronizadas com o banco');
        }

        function updateSparkline() {
            if (typeof Chart === 'undefined') { ensureChartJs().then(() => updateSparkline()); return; }
            const ctx = document.getElementById('inspecoesSparkline');
            if (!ctx || typeof Chart === 'undefined') return;
            const last = inspections.slice(-7);
            const data = last.map(i => i.results?.percentage || 0);
            const labels = last.map(i => new Date(i.data).toLocaleDateString('pt-BR'));
            if (!sparklineChart) {
                sparklineChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels, datasets: [{ data, borderColor: '#5D5CDE', backgroundColor: 'rgba(93,92,222,0.15)', fill: true, tension: 0.4 }] },
                    options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } }, elements: { point: { radius: 0 } } }
                });
            } else {
                sparklineChart.data.labels = labels;
                sparklineChart.data.datasets[0].data = data;
                sparklineChart.update();
            }
        }

        function updateAnalytics() {
            const containerIssues = document.getElementById('criticalIssues');
            const containerTop = document.getElementById('topMecanicos');
            const badge = document.getElementById('criticalCountBadge');
            const cardCrit = document.getElementById('criticalCountCard');
            const eqSel = document.getElementById('equipmentFilter');
            const ldSel = document.getElementById('leaderFilter');
            const eqFilter = eqSel ? eqSel.value : 'all';
            const ldFilter = ldSel ? ldSel.value : 'all';
            const filteredAll = inspections.filter(i => {
                const byEq = eqFilter === 'all' ? true : i.tipo === eqFilter;
                const byLd = ldFilter === 'all' ? true : (i.mecanico || '') === ldFilter;
                return byEq && byLd;
            });
            if (containerIssues) {
                const crit = filteredAll.filter(i => (i.results?.percentage||0) < 60 || (i.results?.notOk||0) > (i.results?.ok||0)).slice(0,3);
                if (badge) { badge.textContent = `${crit.length} ativos`; }
                if (cardCrit) { cardCrit.textContent = `${crit.length}`; }
                if (crit.length === 0) {
                    containerIssues.innerHTML = `<div class="text-center text-gray-500 dark:text-gray-400 py-6">Nenhum problema crítico</div>`;
                } else {
                    containerIssues.innerHTML = crit.map(i => {
                        const color = (i.results?.percentage||0) < 60 ? 'red' : 'yellow';
                        const nots = i.results?.notOk||0;
                        const when = i.created_at ? new Date(i.created_at).toLocaleString('pt-BR') : new Date(i.data).toLocaleDateString('pt-BR');
                        return `
                            <div class="flex items-start space-x-3 p-4 bg-${color}-50 dark:bg-${color}-900/20 rounded-lg">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-${color}-100 dark:bg-${color}-900 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-${color}-600 dark:text-${color}-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">${i.tipo} ${i.frota}</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${nots} itens NÃO OK</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">${when}</p>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }
            if (containerTop) {
                const byMech = {};
                filteredAll.forEach(i => {
                    const m = i.mecanico||'--';
                    if (!byMech[m]) byMech[m] = { count:0, sum:0 };
                    byMech[m].count++;
                    byMech[m].sum += i.results?.percentage||0;
                });
                const ranking = Object.entries(byMech).map(([m,v])=>({m, avg: v.count?Math.round(v.sum/v.count):0, count:v.count})).sort((a,b)=>b.avg-a.avg).slice(0,3);
                if (ranking.length === 0) {
                    containerTop.innerHTML = `<div class="text-center text-gray-500 dark:text-gray-400 py-6">Sem dados</div>`;
                } else {
                    containerTop.innerHTML = ranking.map((r,idx)=>{
                        return `
                            <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
                                        <span class="text-green-600 dark:text-green-400 font-bold text-sm">${idx+1}</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">${r.m}</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">${r.count} inspeções</p>
                                    </div>
                                </div>
                                <span class="text-sm font-semibold text-green-700 dark:text-green-300">${r.avg}%</span>
                            </div>
                        `;
                    }).join('');
                }
            }
        }

        // Report generation functions
        function generateReport() {
            const type = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            let format = document.getElementById('reportFormat').value;
            const supported = ['csv','excel','pdf','json'];
            if (!supported.includes(format)) { format = 'csv'; }
            const daysMap = { '7': 7, '30': 30, '90': 90 };
            const days = daysMap[period] || 30;
            const end = new Date();
            const start = new Date();
            start.setDate(end.getDate() - days + 1);
            const filtered = inspections.filter(i => {
                const d = new Date(i.data);
                return d >= start && d <= end;
            });
            const total = filtered.length;
            const avg = total ? Math.round(filtered.reduce((s,i)=>s+(i.results?.percentage||0),0)/total) : 0;
            const counts = { caminhao: 0, trator: 0, colhedora: 0, reboque: 0, manutencao: 0 };
            filtered.forEach(i => { if (counts[i.tipo] !== undefined) counts[i.tipo]++; });
            if (format === 'json') {
                const payload = {
                    type,
                    period,
                    summary: { total, average: avg, counts },
                    inspections: filtered
                };
                const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `relatorio_${type}_${period}.json`;
                a.click();
                URL.revokeObjectURL(a.href);
                showFloatingNotification('success', 'Relatório JSON gerado');
            } else if (format === 'csv') {
                const header = ['data','tipo','frota','lider','ok','nao_ok','percentual'];
                const rows = filtered.map(i => [
                    i.data,
                    i.tipo,
                    i.frota,
                    i.mecanico,
                    i.results?.ok||0,
                    i.results?.notOk||0,
                    i.results?.percentage||0
                ].join(','));
                const csv = [header.join(','), ...rows].join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `relatorio_${type}_${period}.csv`;
                a.click();
                URL.revokeObjectURL(a.href);
                showFloatingNotification('success', 'Relatório CSV gerado');
            } else if (format === 'excel') {
                const header = ['Data','Tipo','Frota','Mecânico','OK','NÃO OK','Percentual'];
                const rows = filtered.map(i => `
                    <tr>
                        <td>${i.data}</td>
                        <td>${i.tipo}</td>
                        <td>${i.frota}</td>
                        <td>${i.mecanico}</td>
                        <td>${i.results?.ok||0}</td>
                        <td>${i.results?.notOk||0}</td>
                        <td>${i.results?.percentage||0}</td>
                    </tr>
                `).join('');
                const html = `
                    <html><head>
                        <meta charset="utf-8" />
                    </head><body>
                        <table border="1">
                            <thead><tr>${header.map(h=>`<th>${h}</th>`).join('')}</tr></thead>
                            <tbody>${rows}</tbody>
                        </table>
                    </body></html>
                `;
                const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `relatorio_${type}_${period}.xls`;
                a.click();
                URL.revokeObjectURL(a.href);
                showFloatingNotification('success', 'Relatório Excel (XLS) gerado');
            } else if (format === 'pdf') {
                const rows = filtered.map(i => `
                    <tr>
                        <td>${new Date(i.data).toLocaleDateString('pt-BR')}</td>
                        <td>${i.tipo}</td>
                        <td>${i.frota}</td>
                        <td>${i.mecanico}</td>
                        <td>${i.results?.ok||0}</td>
                        <td>${i.results?.notOk||0}</td>
                        <td>${i.results?.percentage||0}%</td>
                    </tr>
                `).join('');
                const dist = counts;
                const dateRange = `${start.toLocaleDateString('pt-BR')} — ${end.toLocaleDateString('pt-BR')}`;
                const doc = `
                    <html><head>
                        <meta charset="utf-8" />
                        <title>Relatório</title>
                        <style>
                            @page { size: A4 portrait; margin: 12mm; }
                            * { box-sizing: border-box; }
                            body { font-family: Inter, Arial, sans-serif; padding: 0; color: #111827; }
                            .container { max-width: 940px; margin: 0 auto; padding: 24px; }
                            .header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 16px; }
                            .brand { display:flex; align-items:center; gap:10px; }
                            .logo { width:28px; height:28px; border-radius:8px; background:#5D5CDE; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; }
                            .title { font-size: 18px; font-weight: 700; }
                            .subtitle { font-size: 12px; color:#6B7280; }
                            .kpis { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:12px; margin: 18px 0; }
                            .card { border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fff; }
                            .card h4 { margin:0; font-size:12px; color:#6B7280; }
                            .card .value { font-size:20px; font-weight:700; margin-top:6px; }
                            .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
                            .chip { font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid #e5e7eb; color:#374151; background:#f9fafb; }
                            .table-wrap { margin-top: 16px; }
                            table { width: 100%; border-collapse: collapse; table-layout: fixed; }
                            thead th { background: #f3f4f6; text-align: left; font-size: 11px; color:#374151; border-bottom:1px solid #e5e7eb; }
                            th, td { border: 1px solid #e5e7eb; padding: 8px 10px; font-size: 11px; word-break: break-word; }
                            tbody tr:nth-child(odd) { background: #fafafa; }
                            .badge { display:inline-block; border-radius:6px; padding:2px 6px; font-size:11px; }
                            .ok { background:#ECFDF5; color:#065F46; border:1px solid #D1FAE5; }
                            .nok { background:#FEF2F2; color:#7F1D1D; border:1px solid #FECACA; }
                            .footer { margin-top: 18px; font-size: 11px; color:#6B7280; text-align:right; }
                            @media screen { body { background:#f3f4f6; } .container { background:#fff; padding:24px; box-shadow: 0 1px 6px rgba(0,0,0,0.08); } }
                        </style>
                    </head><body onload="window.print()">
                        <div class="container">
                            <div class="header">
                                <div class="brand"><div class="logo">C</div><div><div class="title">Relatório ${type}</div><div class="subtitle">${dateRange}</div></div></div>
                                <div class="subtitle">Gerado em ${new Date().toLocaleString('pt-BR')}</div>
                            </div>
                            <div class="kpis">
                                <div class="card"><h4>Total</h4><div class="value">${total}</div></div>
                                <div class="card"><h4>Média de aprovação</h4><div class="value">${avg}%</div></div>
                                <div class="card"><h4>Distribuição</h4>
                                    <div class="chips">
                                        <span class="chip">Caminhões: ${dist.caminhao}</span>
                                        <span class="chip">Tratores: ${dist.trator}</span>
                                        <span class="chip">Colhedoras: ${dist.colhedora}</span>
                                        <span class="chip">Reboques: ${dist.reboque}</span>
                                        <span class="chip">Manutenção: ${dist.manutencao}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="table-wrap">
                                <table>
                                    <thead>
                                        <tr><th>Data</th><th>Tipo</th><th>Frota</th><th>Líder</th><th>OK</th><th>NÃO OK</th><th>%</th></tr>
                                    </thead>
                                    <tbody>${rows}</tbody>
                                </table>
                            </div>
                            <div class="footer">Sistema de Checklist • ${new Date().getFullYear()}</div>
                        </div>
                    </body></html>
                `;
                const w = window.open('', '_blank');
                if (w) { w.document.write(doc); w.document.close(); }
                showFloatingNotification('success', 'Relatório PDF preparado (use Salvar como PDF)');
            } else {
                showFloatingNotification('warning', 'Formato não suportado. Use CSV, Excel ou PDF.');
            }
        }

        function generateQuickReport(type) {
            const sel = document.getElementById('reportType');
            const per = document.getElementById('reportPeriod');
            const fmt = document.getElementById('reportFormat');
            if (sel) sel.value = type;
            if (per) per.value = '30';
            if (fmt) fmt.value = 'csv';
            generateReport();
        }

        function scheduleReport() {
            showFloatingNotification('info', 'Funcionalidade de agendamento será implementada em breve.');
        }

        // Initialize charts when analytics section is shown
        document.addEventListener('DOMContentLoaded', function() {
            // Show notification badge if there are notifications
            if (notifications.length > 0) {
                const badge = document.getElementById('notificationBadge');
                badge.textContent = notifications.length;
                badge.classList.remove('hidden');
            }
            
            setTimeout(() => {
                const sel = document.getElementById('chartPeriod');
                const stored = localStorage.getItem('chartPeriod');
                if (sel && stored) sel.value = stored;
                initializeCharts();
                if (sel && !sel._persistBound) {
                    sel.addEventListener('change', () => localStorage.setItem('chartPeriod', sel.value));
                    sel._persistBound = true;
                }
            }, 500);
            const tip = document.getElementById('filtroTipo');
            const d1 = document.getElementById('filtroDataInicial');
            const d2 = document.getElementById('filtroDataFinal');
            const deb = debounce(filterHistory, 200);
            if (tip && !tip._bound) { tip.addEventListener('change', deb); tip._bound = true; }
            if (d1 && !d1._bound) { d1.addEventListener('input', deb); d1._bound = true; }
            if (d2 && !d2._bound) { d2.addEventListener('input', deb); d2._bound = true; }
            window.addEventListener('online', () => { showFloatingNotification('success', 'Conectado'); syncPendingInspections(); });
            window.addEventListener('offline', () => { showFloatingNotification('warning', 'Sem internet. Operando offline.'); });
            const printBtn = document.getElementById('printInspectionBtn');
            if (printBtn && !printBtn._bound) {
                printBtn.addEventListener('click', function() {
                    if (!currentInspectionId) { showCustomAlert('Selecione uma inspeção'); return; }
                    this.disabled = true;
                    try { printInspection(currentInspectionId); } finally { setTimeout(() => { this.disabled = false; }, 800); }
                });
                printBtn._bound = true;
            }
        });

        function openSettings() { 
            const sel = document.getElementById('themeModeSelect');
            const cur = localStorage.getItem('theme') || 'system';
            if (sel) sel.value = cur;
            showModal('settingsModal'); 
        }
        function setThemeMode(mode) {
            try { localStorage.setItem('theme', mode); } catch(_) {}
            initTheme();
        }
        function applyThemeChoice() {
            const sel = document.getElementById('themeModeSelect');
            if (sel) setThemeMode(sel.value);
            closeModal('settingsModal');
            showFloatingNotification('success', 'Tema atualizado');
        }

        function initTheme() {
            try {
                const s = localStorage.getItem('theme');
                const p = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                const d = s ? s === 'dark' : p;
                if (d) { document.documentElement.classList.add('dark'); } else { document.documentElement.classList.remove('dark'); }
            } catch (_) {}
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch (_) {}
        }

        // Hide notification center when clicking outside
        document.addEventListener('click', function(e) {
            const center = document.getElementById('notificationCenter');
            const button = e.target.closest('button[onclick="showNotificationCenter()"]');
            
            if (!center.contains(e.target) && !button) {
                center.classList.add('hidden');
            }
        });

        // Show welcome notification
        setTimeout(() => {
            showFloatingNotification('success', 'Bem-vindo ao Sistema Avançado de Checklist de Manutenção!', 3000);
        }, 1000);
    </script>
</body>
</html>
